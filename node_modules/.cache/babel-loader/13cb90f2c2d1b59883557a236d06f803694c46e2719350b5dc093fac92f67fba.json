{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PolicyConstraints = void 0;\nvar json_1 = require(\"../../util/json\");\nvar Coin_1 = require(\"../Coin\");\nvar numeric_1 = require(\"../numeric\");\nvar treasury_1 = require(\"@classic-terra/terra.proto/terra/treasury/v1beta1/treasury\");\n/**\n * This captures the Treasury module's `tax_policy` and `reward_policy` parameters, which\n * determine how the Tax Rate and Reward Weight values are allowed to change.\n */\nvar PolicyConstraints = /** @class */function (_super) {\n  __extends(PolicyConstraints, _super);\n  /**\n   *\n   * @param rate_min minimum value\n   * @param rate_max maximum value\n   * @param cap Tax Cap (only applicable for Tax Rate)\n   * @param change_rate_max max change %\n   */\n  function PolicyConstraints(rate_min, rate_max, cap, change_rate_max) {\n    var _this = _super.call(this) || this;\n    _this.cap = cap;\n    _this.rate_min = new numeric_1.Dec(rate_min);\n    _this.rate_max = new numeric_1.Dec(rate_max);\n    _this.change_rate_max = new numeric_1.Dec(change_rate_max);\n    return _this;\n  }\n  PolicyConstraints.fromAmino = function (data) {\n    var rate_min = data.rate_min,\n      rate_max = data.rate_max,\n      cap = data.cap,\n      change_rate_max = data.change_rate_max;\n    return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromAmino(cap), change_rate_max);\n  };\n  PolicyConstraints.prototype.toAmino = function () {\n    var _a = this,\n      rate_min = _a.rate_min,\n      rate_max = _a.rate_max,\n      cap = _a.cap,\n      change_rate_max = _a.change_rate_max;\n    return {\n      rate_min: rate_min.toString(),\n      rate_max: rate_max.toString(),\n      cap: cap.toAmino(),\n      change_rate_max: change_rate_max.toString()\n    };\n  };\n  PolicyConstraints.fromData = function (data) {\n    var rate_min = data.rate_min,\n      rate_max = data.rate_max,\n      cap = data.cap,\n      change_rate_max = data.change_rate_max;\n    return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromData(cap), change_rate_max);\n  };\n  PolicyConstraints.prototype.toData = function () {\n    var _a = this,\n      rate_min = _a.rate_min,\n      rate_max = _a.rate_max,\n      cap = _a.cap,\n      change_rate_max = _a.change_rate_max;\n    return {\n      rate_min: rate_min.toString(),\n      rate_max: rate_max.toString(),\n      cap: cap.toData(),\n      change_rate_max: change_rate_max.toString()\n    };\n  };\n  PolicyConstraints.fromProto = function (proto) {\n    return new PolicyConstraints(proto.rateMax, proto.rateMin, Coin_1.Coin.fromProto(proto.cap), proto.changeRateMax);\n  };\n  PolicyConstraints.prototype.toProto = function () {\n    var _a = this,\n      rate_min = _a.rate_min,\n      rate_max = _a.rate_max,\n      cap = _a.cap,\n      change_rate_max = _a.change_rate_max;\n    return treasury_1.PolicyConstraints.fromPartial({\n      cap: cap.toProto(),\n      changeRateMax: change_rate_max.toString(),\n      rateMax: rate_max.toString(),\n      rateMin: rate_min.toString()\n    });\n  };\n  /**\n   * You can simulate the result of the clamping algorithm, which subjects updates in\n   * rate to the rules defined by the `PolicyConstraints`.\n   *\n   * @param prevRate previous rate\n   * @param newRate next rate\n   * @returns New rate, after clamping constraints have been applied\n   */\n  PolicyConstraints.prototype.clamp = function (prevRate, newRate) {\n    var p = new numeric_1.Dec(prevRate); // prev\n    var n = new numeric_1.Dec(newRate); // new\n    if (n.lt(this.rate_min)) {\n      n = this.rate_min;\n    } else if (n.gt(this.rate_max)) {\n      n = this.rate_max;\n    }\n    var delta = n.sub(p);\n    if (n.gt(p)) {\n      if (delta.gt(this.change_rate_max)) {\n        n = p.add(this.change_rate_max);\n      }\n    } else {\n      if (delta.abs().gt(this.change_rate_max)) {\n        n = p.sub(this.change_rate_max);\n      }\n    }\n    return n;\n  };\n  return PolicyConstraints;\n}(json_1.JSONSerializable);\nexports.PolicyConstraints = PolicyConstraints;","map":{"version":3,"names":["json_1","require","Coin_1","numeric_1","treasury_1","PolicyConstraints","_super","__extends","rate_min","rate_max","cap","change_rate_max","_this","call","Dec","fromAmino","data","Coin","prototype","toAmino","_a","toString","fromData","toData","fromProto","proto","rateMax","rateMin","changeRateMax","toProto","fromPartial","clamp","prevRate","newRate","p","n","lt","gt","delta","sub","add","abs","JSONSerializable","exports"],"sources":["../../../src/core/treasury/PolicyConstraints.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}