{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Wallet = void 0;\nvar signing_1 = require(\"@terra-money/terra.proto/cosmos/tx/signing/v1beta1/signing\");\nvar Wallet = /** @class */function () {\n  function Wallet(lcd, key) {\n    this.lcd = lcd;\n    this.key = key;\n  }\n  Wallet.prototype.accountNumberAndSequence = function () {\n    return this.lcd.auth.accountInfo(this.key.accAddress).then(function (d) {\n      return {\n        account_number: d.getAccountNumber(),\n        sequence: d.getSequenceNumber()\n      };\n    });\n  };\n  Wallet.prototype.accountNumber = function () {\n    return this.lcd.auth.accountInfo(this.key.accAddress).then(function (d) {\n      return d.getAccountNumber();\n    });\n  };\n  Wallet.prototype.sequence = function () {\n    return this.lcd.auth.accountInfo(this.key.accAddress).then(function (d) {\n      return d.getSequenceNumber();\n    });\n  };\n  Wallet.prototype.createTx = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.lcd.tx.create([{\n          address: this.key.accAddress,\n          sequenceNumber: options.sequence,\n          publicKey: this.key.publicKey\n        }], options)];\n      });\n    });\n  };\n  Wallet.prototype.createAndSignTx = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var accountNumber, sequence, res, tx;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            accountNumber = options.accountNumber;\n            sequence = options.sequence;\n            if (!(accountNumber === undefined || sequence === undefined)) return [3 /*break*/, 2];\n            return [4 /*yield*/, this.accountNumberAndSequence()];\n          case 1:\n            res = _a.sent();\n            if (accountNumber === undefined) {\n              accountNumber = res.account_number;\n            }\n            if (sequence === undefined) {\n              sequence = res.sequence;\n            }\n            _a.label = 2;\n          case 2:\n            options.sequence = sequence;\n            options.accountNumber = accountNumber;\n            return [4 /*yield*/, this.createTx(options)];\n          case 3:\n            tx = _a.sent();\n            return [2 /*return*/, this.key.signTx(tx, {\n              accountNumber: accountNumber,\n              sequence: sequence,\n              chainID: this.lcd.config.chainID,\n              signMode: options.signMode || signing_1.SignMode.SIGN_MODE_DIRECT\n            }, this.lcd.config.isClassic)];\n        }\n      });\n    });\n  };\n  return Wallet;\n}();\nexports.Wallet = Wallet;","map":{"version":3,"names":["signing_1","require","Wallet","lcd","key","prototype","accountNumberAndSequence","auth","accountInfo","accAddress","then","d","account_number","getAccountNumber","sequence","getSequenceNumber","accountNumber","createTx","options","tx","create","address","sequenceNumber","publicKey","createAndSignTx","undefined","res","_a","sent","signTx","chainID","config","signMode","SignMode","SIGN_MODE_DIRECT","isClassic","exports"],"sources":["../../../src/client/lcd/Wallet.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}