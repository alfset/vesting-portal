{"ast":null,"code":"import{setupWalletSelector}from\"@near-wallet-selector/core\";import{setupModal}from\"@near-wallet-selector/modal-ui\";// import { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\n// import { setupMyNearWallet } from \"@near-wallet-selector/my-near-wallet\";\nimport{setupSender}from\"@near-wallet-selector/sender\";// import { setupHereWallet } from \"@near-wallet-selector/here-wallet\";\n// import { setupMathWallet } from \"@near-wallet-selector/math-wallet\";\nimport{setupNightly}from\"@near-wallet-selector/nightly\";import{setupMeteorWallet}from\"@near-wallet-selector/meteor-wallet\";// import { setupNarwallets } from \"@near-wallet-selector/narwallets\";\n// import { setupWelldoneWallet } from \"@near-wallet-selector/welldone-wallet\";\n// import { setupNearSnap } from \"@near-wallet-selector/near-snap\";\n// import { setupLedger } from \"@near-wallet-selector/ledger\";\n// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\n// import { setupNightlyConnect } from \"@near-wallet-selector/nightly-connect\";\n// import { setupNearFi } from \"@near-wallet-selector/nearfi\";\n// import { setupCoin98Wallet } from \"@near-wallet-selector/coin98-wallet\";\n// import { setupOptoWallet } from \"@near-wallet-selector/opto-wallet\";\n// import { setupFinerWallet } from \"@near-wallet-selector/finer-wallet\";\n// import { setupNeth } from \"@near-wallet-selector/neth\";\n// import { setupXDEFI } from \"@near-wallet-selector/xdefi\";\nimport React,{useCallback,useContext,useEffect,useState}from\"react\";import{distinctUntilChanged,map}from\"rxjs\";import{useActiveReact}from'../../hooks/useActiveReact';import{ChainId}from\"../../config/chainConfig/chainId\";const WalletSelectorContext=React.createContext(null);// export const WalletSelectorContextProvider: React.FC<{\n//   children: ReactNode;\n// }> = ({ children }) => {\nexport function WalletSelectorContextProvider(_ref){var _accounts$find;let{children}=_ref;const{chainId}=useActiveReact();const[selector,setSelector]=useState(null);const[modal,setModal]=useState(null);const[accounts,setAccounts]=useState([]);const init=useCallback(async()=>{const _selector=await setupWalletSelector({// network: \"testnet\",\nnetwork:chainId===ChainId.NEAR?\"mainnet\":'testnet',debug:true,modules:[// setupNearWallet(),\n// setupMyNearWallet(),\nsetupSender(),// setupHereWallet(),\n// setupMathWallet(),\nsetupNightly(),setupMeteorWallet()// setupNearSnap(),\n// setupNarwallets(),\n// setupWelldoneWallet(),\n// setupLedger(),\n// setupNearFi(),\n// setupCoin98Wallet(),\n// setupOptoWallet(),\n// setupFinerWallet(),\n// setupNeth(),\n// setupXDEFI(),\n// setupWalletConnect({\n//   projectId: \"c4f79cc...\",\n//   metadata: {\n//     name: \"NEAR Wallet Selector\",\n//     description: \"Example dApp used by NEAR Wallet Selector\",\n//     url: \"https://github.com/near/wallet-selector\",\n//     icons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n//   },\n// }),\n// setupNightlyConnect({\n//   url: \"wss://relay.nightly.app/app\",\n//   appMetadata: {\n//     additionalInfo: \"\",\n//     application: \"NEAR Wallet Selector\",\n//     description: \"Example dApp used by NEAR Wallet Selector\",\n//     icon: \"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\",\n//   },\n// }),\n]});const _modal=setupModal(_selector,{contractId:\"guest-book.testnet\"});const state=_selector.store.getState();setAccounts(state.accounts);window.selector=_selector;window.modal=_modal;setSelector(_selector);setModal(_modal);},[]);useEffect(()=>{init().catch(err=>{console.error(err);alert(\"Failed to initialise wallet selector\");});},[init]);useEffect(()=>{// console.log(selector)\nif(!selector){return;}const subscription=selector.store.observable.pipe(map(state=>state.accounts),distinctUntilChanged()).subscribe(nextAccounts=>{console.log(\"Accounts Update\",nextAccounts);setAccounts(nextAccounts);});const onHideSubscription=modal?modal.on(\"onHide\",_ref2=>{let{hideReason}=_ref2;console.log(\"The reason for hiding the modal \".concat(hideReason));}):undefined;return()=>{subscription.unsubscribe();onHideSubscription.remove();};},[selector]);if(!selector||!modal){return/*#__PURE__*/React.createElement(React.Fragment,null,\"Loading\");}const accountId=((_accounts$find=accounts.find(account=>account.active))===null||_accounts$find===void 0?void 0:_accounts$find.accountId)||null;// const handleSignOut = async () => {\n//   const wallet = await selector.wallet();\n//   wallet.signOut().catch((err) => {\n//     console.log(\"Failed to sign out\");\n//     console.error(err);\n//   });\n// };\n// const handleSwitchWallet = () => {\n//   modal.show();\n// };\nreturn/*#__PURE__*/React.createElement(WalletSelectorContext.Provider,{value:{selector,modal,accounts,accountId}},children);};export function useWalletSelector(){const context=useContext(WalletSelectorContext);if(!context){throw new Error(\"useWalletSelector must be used within a WalletSelectorContextProvider\");}return context;}","map":{"version":3,"names":["setupWalletSelector","setupModal","setupSender","setupNightly","setupMeteorWallet","React","useCallback","useContext","useEffect","useState","distinctUntilChanged","map","useActiveReact","ChainId","WalletSelectorContext","createContext","WalletSelectorContextProvider","_ref","_accounts$find","children","chainId","selector","setSelector","modal","setModal","accounts","setAccounts","init","_selector","network","NEAR","debug","modules","_modal","contractId","state","store","getState","window","catch","err","console","error","alert","subscription","observable","pipe","subscribe","nextAccounts","log","onHideSubscription","on","_ref2","hideReason","concat","undefined","unsubscribe","remove","createElement","Fragment","accountId","find","account","active","Provider","value","useWalletSelector","context","Error"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/nonevm/near/WalletSelectorContext.tsx"],"sourcesContent":["\nimport type { AccountState, WalletSelector } from \"@near-wallet-selector/core\";\nimport { setupWalletSelector } from \"@near-wallet-selector/core\";\n\nimport type { WalletSelectorModal } from \"@near-wallet-selector/modal-ui\";\nimport { setupModal } from \"@near-wallet-selector/modal-ui\";\n\n// import { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\n// import { setupMyNearWallet } from \"@near-wallet-selector/my-near-wallet\";\nimport { setupSender } from \"@near-wallet-selector/sender\";\n// import { setupHereWallet } from \"@near-wallet-selector/here-wallet\";\n// import { setupMathWallet } from \"@near-wallet-selector/math-wallet\";\nimport { setupNightly } from \"@near-wallet-selector/nightly\";\nimport { setupMeteorWallet } from \"@near-wallet-selector/meteor-wallet\";\n// import { setupNarwallets } from \"@near-wallet-selector/narwallets\";\n// import { setupWelldoneWallet } from \"@near-wallet-selector/welldone-wallet\";\n// import { setupNearSnap } from \"@near-wallet-selector/near-snap\";\n// import { setupLedger } from \"@near-wallet-selector/ledger\";\n// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\n// import { setupNightlyConnect } from \"@near-wallet-selector/nightly-connect\";\n// import { setupNearFi } from \"@near-wallet-selector/nearfi\";\n// import { setupCoin98Wallet } from \"@near-wallet-selector/coin98-wallet\";\n// import { setupOptoWallet } from \"@near-wallet-selector/opto-wallet\";\n// import { setupFinerWallet } from \"@near-wallet-selector/finer-wallet\";\n// import { setupNeth } from \"@near-wallet-selector/neth\";\n// import { setupXDEFI } from \"@near-wallet-selector/xdefi\";\n\nimport type { ReactNode } from \"react\";\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\nimport { distinctUntilChanged, map } from \"rxjs\";\n\nimport {useActiveReact} from '../../hooks/useActiveReact'\nimport { ChainId } from \"../../config/chainConfig/chainId\";\n\n\ndeclare global {\n  interface Window {\n    selector: WalletSelector;\n    modal: WalletSelectorModal;\n  }\n}\n\ninterface WalletSelectorContextValue {\n  selector: WalletSelector;\n  modal: WalletSelectorModal;\n  accounts: Array<AccountState>;\n  accountId: string | null;\n}\n\nconst WalletSelectorContext =\n  React.createContext<WalletSelectorContextValue | null>(null);\n\n// export const WalletSelectorContextProvider: React.FC<{\n//   children: ReactNode;\n// }> = ({ children }) => {\nexport function WalletSelectorContextProvider({\n  children\n}: {children: ReactNode}) {\n  const {chainId} = useActiveReact()\n  const [selector, setSelector] = useState<WalletSelector | null>(null);\n  const [modal, setModal] = useState<WalletSelectorModal | null>(null);\n  const [accounts, setAccounts] = useState<Array<AccountState>>([]);\n\n  const init = useCallback(async () => {\n    const _selector = await setupWalletSelector({\n      // network: \"testnet\",\n      network: chainId === ChainId.NEAR ? \"mainnet\" : 'testnet',\n      debug: true,\n      modules: [\n        // setupNearWallet(),\n        // setupMyNearWallet(),\n        setupSender(),\n        // setupHereWallet(),\n        // setupMathWallet(),\n        setupNightly(),\n        setupMeteorWallet(),\n        // setupNearSnap(),\n        // setupNarwallets(),\n        // setupWelldoneWallet(),\n        // setupLedger(),\n        // setupNearFi(),\n        // setupCoin98Wallet(),\n        // setupOptoWallet(),\n        // setupFinerWallet(),\n        // setupNeth(),\n        // setupXDEFI(),\n        // setupWalletConnect({\n        //   projectId: \"c4f79cc...\",\n        //   metadata: {\n        //     name: \"NEAR Wallet Selector\",\n        //     description: \"Example dApp used by NEAR Wallet Selector\",\n        //     url: \"https://github.com/near/wallet-selector\",\n        //     icons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n        //   },\n        // }),\n        // setupNightlyConnect({\n        //   url: \"wss://relay.nightly.app/app\",\n        //   appMetadata: {\n        //     additionalInfo: \"\",\n        //     application: \"NEAR Wallet Selector\",\n        //     description: \"Example dApp used by NEAR Wallet Selector\",\n        //     icon: \"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\",\n        //   },\n        // }),\n      ],\n    });\n    const _modal = setupModal(_selector, {\n      contractId: \"guest-book.testnet\",\n    });\n    const state = _selector.store.getState();\n    setAccounts(state.accounts);\n\n    window.selector = _selector;\n    window.modal = _modal;\n\n    setSelector(_selector);\n    setModal(_modal);\n  }, []);\n\n  useEffect(() => {\n    init().catch((err) => {\n      console.error(err);\n      alert(\"Failed to initialise wallet selector\");\n    });\n  }, [init]);\n\n  useEffect(() => {\n    // console.log(selector)\n    if (!selector) {\n      return;\n    }\n\n    const subscription = selector.store.observable\n      .pipe(\n        map((state: any) => state.accounts),\n        distinctUntilChanged()\n      )\n      .subscribe((nextAccounts: any) => {\n        console.log(\"Accounts Update\", nextAccounts);\n\n        setAccounts(nextAccounts);\n      });\n\n    const onHideSubscription: any = modal ? modal.on(\"onHide\", ({ hideReason }) => {\n      console.log(`The reason for hiding the modal ${hideReason}`);\n    }) : undefined;\n\n    return () => {\n      subscription.unsubscribe();\n      onHideSubscription.remove();\n    };\n  }, [selector]);\n\n  if (!selector || !modal) {\n    return <>Loading</>;\n  }\n\n  const accountId =\n    accounts.find((account) => account.active)?.accountId || null;\n\n  // const handleSignOut = async () => {\n  //   const wallet = await selector.wallet();\n\n  //   wallet.signOut().catch((err) => {\n  //     console.log(\"Failed to sign out\");\n  //     console.error(err);\n  //   });\n  // };\n  // const handleSwitchWallet = () => {\n  //   modal.show();\n  // };\n  return (\n    <WalletSelectorContext.Provider\n      value={{\n        selector,\n        modal,\n        accounts,\n        accountId,\n      }}\n    >\n      {/* <div onClick={()=> handleSignOut()}>Out</div>\n      <div onClick={()=> handleSwitchWallet()}>Switch Wallet</div> */}\n      {children}\n    </WalletSelectorContext.Provider>\n  );\n};\n\nexport function useWalletSelector() {\n  const context = useContext(WalletSelectorContext);\n\n  if (!context) {\n    throw new Error(\n      \"useWalletSelector must be used within a WalletSelectorContextProvider\"\n    );\n  }\n\n  return context;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}