{"ast":null,"code":"import { AbstractConnector } from '@web3-react/abstract-connector';\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nvar CHAIN_ID = 1;\nvar WalletLinkConnector = /*#__PURE__*/function (_AbstractConnector) {\n  _inheritsLoose(WalletLinkConnector, _AbstractConnector);\n  function WalletLinkConnector(_ref) {\n    var _this;\n    var url = _ref.url,\n      appName = _ref.appName,\n      appLogoUrl = _ref.appLogoUrl,\n      darkMode = _ref.darkMode,\n      supportedChainIds = _ref.supportedChainIds;\n    _this = _AbstractConnector.call(this, {\n      supportedChainIds: supportedChainIds\n    }) || this;\n    _this.url = url;\n    _this.appName = appName;\n    _this.appLogoUrl = appLogoUrl;\n    _this.darkMode = darkMode || false;\n    _this.handleChainChanged = _this.handleChainChanged.bind(_assertThisInitialized(_this));\n    _this.handleAccountsChanged = _this.handleAccountsChanged.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  var _proto = WalletLinkConnector.prototype;\n  _proto.activate = function activate() {\n    try {\n      var _this3 = this;\n      var _temp4 = function _temp4() {\n        return Promise.resolve(_this3.provider.request({\n          method: 'eth_requestAccounts'\n        })).then(function (accounts) {\n          var account = accounts[0];\n          _this3.provider.on('chainChanged', _this3.handleChainChanged);\n          _this3.provider.on('accountsChanged', _this3.handleAccountsChanged);\n          return {\n            provider: _this3.provider,\n            account: account\n          };\n        });\n      };\n      var _temp5 = function () {\n        if (window.ethereum && window.ethereum.isCoinbaseWallet === true) {\n          // user is in the dapp browser on Coinbase Wallet\n          _this3.provider = window.ethereum;\n        } else {\n          var _temp6 = function () {\n            if (!_this3.walletLink) {\n              return Promise.resolve(import('@coinbase/wallet-sdk').then(function (m) {\n                var _m$default;\n                return (_m$default = m == null ? void 0 : m[\"default\"]) != null ? _m$default : m;\n              })).then(function (CoinbaseWalletSDK) {\n                _this3.walletLink = new CoinbaseWalletSDK(_extends({\n                  appName: _this3.appName,\n                  darkMode: _this3.darkMode\n                }, _this3.appLogoUrl ? {\n                  appLogoUrl: _this3.appLogoUrl\n                } : {}));\n                _this3.provider = _this3.walletLink.makeWeb3Provider(_this3.url, CHAIN_ID);\n              });\n            }\n          }();\n          if (_temp6 && _temp6.then) return _temp6.then(function () {});\n        }\n      }();\n\n      // @ts-ignore\n      return Promise.resolve(_temp5 && _temp5.then ? _temp5.then(_temp4) : _temp4(_temp5));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  _proto.getProvider = function getProvider() {\n    try {\n      var _this5 = this;\n      return Promise.resolve(_this5.provider);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  _proto.getChainId = function getChainId() {\n    try {\n      var _this7 = this;\n      return Promise.resolve(_this7.provider.chainId);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  _proto.getAccount = function getAccount() {\n    try {\n      var _this9 = this;\n      return Promise.resolve(_this9.provider.request({\n        method: 'eth_requestAccounts'\n      })).then(function (accounts) {\n        return accounts[0];\n      });\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  _proto.deactivate = function deactivate() {\n    this.provider.removeListener('chainChanged', this.handleChainChanged);\n    this.provider.removeListener('accountsChanged', this.handleAccountsChanged);\n  };\n  _proto.close = function close() {\n    try {\n      var _this11 = this;\n      _this11.provider.close();\n      _this11.emitDeactivate();\n      return Promise.resolve();\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  _proto.handleChainChanged = function handleChainChanged(chainId) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.log(\"Handling 'chainChanged' event with payload\", chainId);\n    }\n    this.emitUpdate({\n      chainId: chainId\n    });\n  };\n  _proto.handleAccountsChanged = function handleAccountsChanged(accounts) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.log(\"Handling 'accountsChanged' event with payload\", accounts);\n    }\n    this.emitUpdate({\n      account: accounts[0]\n    });\n  };\n  return WalletLinkConnector;\n}(AbstractConnector);\nexport { WalletLinkConnector };","map":{"version":3,"names":["CHAIN_ID","WalletLinkConnector","_AbstractConnector","_inheritsLoose","_ref","url","appName","appLogoUrl","darkMode","supportedChainIds","_this","call","handleChainChanged","bind","_assertThisInitialized","handleAccountsChanged","_proto","prototype","activate","_this3","provider","request","method","then","accounts","account","on","window","ethereum","isCoinbaseWallet","walletLink","m","_m$default","CoinbaseWalletSDK","_extends","makeWeb3Provider","e","Promise","reject","getProvider","resolve","_this5","getChainId","_this7","chainId","getAccount","_this9","deactivate","removeListener","close","_this11","emitDeactivate","process","env","NODE_ENV","console","log","emitUpdate","AbstractConnector"],"sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\n\nconst CHAIN_ID = 1\n\ninterface WalletLinkConnectorArguments {\n  url: string\n  appName: string\n  appLogoUrl?: string\n  darkMode?: boolean\n  supportedChainIds?: number[]\n}\n\nexport class WalletLinkConnector extends AbstractConnector {\n  private readonly url: string\n  private readonly appName: string\n  private readonly appLogoUrl?: string\n  private readonly darkMode: boolean\n\n  public walletLink: any\n  private provider: any\n\n  constructor({ url, appName, appLogoUrl, darkMode, supportedChainIds }: WalletLinkConnectorArguments) {\n    super({ supportedChainIds: supportedChainIds })\n\n    this.url = url\n    this.appName = appName\n    this.appLogoUrl = appLogoUrl\n    this.darkMode = darkMode || false\n\n    this.handleChainChanged = this.handleChainChanged.bind(this)\n    this.handleAccountsChanged = this.handleAccountsChanged.bind(this)\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    // @ts-ignore\n    if (window.ethereum && window.ethereum.isCoinbaseWallet === true) {\n      // user is in the dapp browser on Coinbase Wallet\n      this.provider = window.ethereum\n    } else if (!this.walletLink) {\n      const CoinbaseWalletSDK = await import('@coinbase/wallet-sdk').then(m => m?.default ?? m)\n      this.walletLink = new CoinbaseWalletSDK({\n        appName: this.appName,\n        darkMode: this.darkMode,\n        ...(this.appLogoUrl ? { appLogoUrl: this.appLogoUrl } : {})\n      })\n      this.provider = this.walletLink.makeWeb3Provider(this.url, CHAIN_ID)\n    }\n\n    const accounts = await this.provider.request({\n      method: 'eth_requestAccounts'\n    })\n    const account = accounts[0]\n\n    this.provider.on('chainChanged', this.handleChainChanged)\n    this.provider.on('accountsChanged', this.handleAccountsChanged)\n\n    return { provider: this.provider, account: account }\n  }\n\n  public async getProvider(): Promise<any> {\n    return this.provider\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.provider.chainId\n  }\n\n  public async getAccount(): Promise<null | string> {\n    const accounts = await this.provider.request({\n      method: 'eth_requestAccounts'\n    })\n    return accounts[0]\n  }\n\n  public deactivate() {\n    this.provider.removeListener('chainChanged', this.handleChainChanged)\n    this.provider.removeListener('accountsChanged', this.handleAccountsChanged)\n  }\n\n  public async close() {\n    this.provider.close()\n    this.emitDeactivate()\n  }\n\n  private handleChainChanged(chainId: number | string): void {\n    if (__DEV__) {\n      console.log(\"Handling 'chainChanged' event with payload\", chainId)\n    }\n    this.emitUpdate({ chainId: chainId })\n  }\n\n  private handleAccountsChanged(accounts: string[]): void {\n    if (__DEV__) {\n      console.log(\"Handling 'accountsChanged' event with payload\", accounts)\n    }\n    this.emitUpdate({ account: accounts[0] })\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}