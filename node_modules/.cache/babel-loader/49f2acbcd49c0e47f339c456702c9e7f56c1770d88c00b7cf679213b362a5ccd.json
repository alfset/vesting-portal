{"ast":null,"code":"var _jsxFileName = \"/workspace/Planq-Dapps/vesting-portal/src/nonevm/near/WalletSelectorContext.tsx\";\nimport { setupWalletSelector } from \"@near-wallet-selector/core\";\nimport { setupModal } from \"@near-wallet-selector/modal-ui\";\n\n// import { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\n// import { setupMyNearWallet } from \"@near-wallet-selector/my-near-wallet\";\nimport { setupSender } from \"@near-wallet-selector/sender\";\n// import { setupHereWallet } from \"@near-wallet-selector/here-wallet\";\n// import { setupMathWallet } from \"@near-wallet-selector/math-wallet\";\nimport { setupNightly } from \"@near-wallet-selector/nightly\";\nimport { setupMeteorWallet } from \"@near-wallet-selector/meteor-wallet\";\n// import { setupNarwallets } from \"@near-wallet-selector/narwallets\";\n// import { setupWelldoneWallet } from \"@near-wallet-selector/welldone-wallet\";\n// import { setupNearSnap } from \"@near-wallet-selector/near-snap\";\n// import { setupLedger } from \"@near-wallet-selector/ledger\";\n// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\n// import { setupNightlyConnect } from \"@near-wallet-selector/nightly-connect\";\n// import { setupNearFi } from \"@near-wallet-selector/nearfi\";\n// import { setupCoin98Wallet } from \"@near-wallet-selector/coin98-wallet\";\n// import { setupOptoWallet } from \"@near-wallet-selector/opto-wallet\";\n// import { setupFinerWallet } from \"@near-wallet-selector/finer-wallet\";\n// import { setupNeth } from \"@near-wallet-selector/neth\";\n// import { setupXDEFI } from \"@near-wallet-selector/xdefi\";\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\nimport { distinctUntilChanged, map } from \"rxjs\";\nimport { useActiveReact } from '../../hooks/useActiveReact';\nimport { ChainId } from \"../../config/chainConfig/chainId\";\nconst WalletSelectorContext = React.createContext(null);\n\n// export const WalletSelectorContextProvider: React.FC<{\n//   children: ReactNode;\n// }> = ({ children }) => {\nexport function WalletSelectorContextProvider(_ref) {\n  var _accounts$find;\n  let {\n    children\n  } = _ref;\n  const {\n    chainId\n  } = useActiveReact();\n  const [selector, setSelector] = useState(null);\n  const [modal, setModal] = useState(null);\n  const [accounts, setAccounts] = useState([]);\n  const init = useCallback(async () => {\n    const _selector = await setupWalletSelector({\n      // network: \"testnet\",\n      network: chainId === ChainId.NEAR ? \"mainnet\" : 'testnet',\n      debug: true,\n      modules: [\n      // setupNearWallet(),\n      // setupMyNearWallet(),\n      setupSender(),\n      // setupHereWallet(),\n      // setupMathWallet(),\n      setupNightly(), setupMeteorWallet()\n      // setupNearSnap(),\n      // setupNarwallets(),\n      // setupWelldoneWallet(),\n      // setupLedger(),\n      // setupNearFi(),\n      // setupCoin98Wallet(),\n      // setupOptoWallet(),\n      // setupFinerWallet(),\n      // setupNeth(),\n      // setupXDEFI(),\n      // setupWalletConnect({\n      //   projectId: \"c4f79cc...\",\n      //   metadata: {\n      //     name: \"NEAR Wallet Selector\",\n      //     description: \"Example dApp used by NEAR Wallet Selector\",\n      //     url: \"https://github.com/near/wallet-selector\",\n      //     icons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n      //   },\n      // }),\n      // setupNightlyConnect({\n      //   url: \"wss://relay.nightly.app/app\",\n      //   appMetadata: {\n      //     additionalInfo: \"\",\n      //     application: \"NEAR Wallet Selector\",\n      //     description: \"Example dApp used by NEAR Wallet Selector\",\n      //     icon: \"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\",\n      //   },\n      // }),\n      ]\n    });\n\n    const _modal = setupModal(_selector, {\n      contractId: \"guest-book.testnet\"\n    });\n    const state = _selector.store.getState();\n    setAccounts(state.accounts);\n    window.selector = _selector;\n    window.modal = _modal;\n    setSelector(_selector);\n    setModal(_modal);\n  }, []);\n  useEffect(() => {\n    init().catch(err => {\n      console.error(err);\n      alert(\"Failed to initialise wallet selector\");\n    });\n  }, [init]);\n  useEffect(() => {\n    // console.log(selector)\n    if (!selector) {\n      return;\n    }\n    const subscription = selector.store.observable.pipe(map(state => state.accounts), distinctUntilChanged()).subscribe(nextAccounts => {\n      console.log(\"Accounts Update\", nextAccounts);\n      setAccounts(nextAccounts);\n    });\n    const onHideSubscription = modal ? modal.on(\"onHide\", _ref2 => {\n      let {\n        hideReason\n      } = _ref2;\n      console.log(\"The reason for hiding the modal \".concat(hideReason));\n    }) : undefined;\n    return () => {\n      subscription.unsubscribe();\n      onHideSubscription.remove();\n    };\n  }, [selector]);\n  if (!selector || !modal) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, \"Loading\");\n  }\n  const accountId = ((_accounts$find = accounts.find(account => account.active)) === null || _accounts$find === void 0 ? void 0 : _accounts$find.accountId) || null;\n\n  // const handleSignOut = async () => {\n  //   const wallet = await selector.wallet();\n\n  //   wallet.signOut().catch((err) => {\n  //     console.log(\"Failed to sign out\");\n  //     console.error(err);\n  //   });\n  // };\n  // const handleSwitchWallet = () => {\n  //   modal.show();\n  // };\n  return /*#__PURE__*/React.createElement(WalletSelectorContext.Provider, {\n    value: {\n      selector,\n      modal,\n      accounts,\n      accountId\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 5\n    }\n  }, children);\n}\n;\nexport function useWalletSelector() {\n  const context = useContext(WalletSelectorContext);\n  if (!context) {\n    throw new Error(\"useWalletSelector must be used within a WalletSelectorContextProvider\");\n  }\n  return context;\n}","map":{"version":3,"names":["setupWalletSelector","setupModal","setupSender","setupNightly","setupMeteorWallet","React","useCallback","useContext","useEffect","useState","distinctUntilChanged","map","useActiveReact","ChainId","WalletSelectorContext","createContext","WalletSelectorContextProvider","_ref","_accounts$find","children","chainId","selector","setSelector","modal","setModal","accounts","setAccounts","init","_selector","network","NEAR","debug","modules","_modal","contractId","state","store","getState","window","catch","err","console","error","alert","subscription","observable","pipe","subscribe","nextAccounts","log","onHideSubscription","on","_ref2","hideReason","concat","undefined","unsubscribe","remove","createElement","Fragment","accountId","find","account","active","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","useWalletSelector","context","Error"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/nonevm/near/WalletSelectorContext.tsx"],"sourcesContent":["\nimport type { AccountState, WalletSelector } from \"@near-wallet-selector/core\";\nimport { setupWalletSelector } from \"@near-wallet-selector/core\";\n\nimport type { WalletSelectorModal } from \"@near-wallet-selector/modal-ui\";\nimport { setupModal } from \"@near-wallet-selector/modal-ui\";\n\n// import { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\n// import { setupMyNearWallet } from \"@near-wallet-selector/my-near-wallet\";\nimport { setupSender } from \"@near-wallet-selector/sender\";\n// import { setupHereWallet } from \"@near-wallet-selector/here-wallet\";\n// import { setupMathWallet } from \"@near-wallet-selector/math-wallet\";\nimport { setupNightly } from \"@near-wallet-selector/nightly\";\nimport { setupMeteorWallet } from \"@near-wallet-selector/meteor-wallet\";\n// import { setupNarwallets } from \"@near-wallet-selector/narwallets\";\n// import { setupWelldoneWallet } from \"@near-wallet-selector/welldone-wallet\";\n// import { setupNearSnap } from \"@near-wallet-selector/near-snap\";\n// import { setupLedger } from \"@near-wallet-selector/ledger\";\n// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\n// import { setupNightlyConnect } from \"@near-wallet-selector/nightly-connect\";\n// import { setupNearFi } from \"@near-wallet-selector/nearfi\";\n// import { setupCoin98Wallet } from \"@near-wallet-selector/coin98-wallet\";\n// import { setupOptoWallet } from \"@near-wallet-selector/opto-wallet\";\n// import { setupFinerWallet } from \"@near-wallet-selector/finer-wallet\";\n// import { setupNeth } from \"@near-wallet-selector/neth\";\n// import { setupXDEFI } from \"@near-wallet-selector/xdefi\";\n\nimport type { ReactNode } from \"react\";\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\nimport { distinctUntilChanged, map } from \"rxjs\";\n\nimport {useActiveReact} from '../../hooks/useActiveReact'\nimport { ChainId } from \"../../config/chainConfig/chainId\";\n\n\ndeclare global {\n  interface Window {\n    selector: WalletSelector;\n    modal: WalletSelectorModal;\n  }\n}\n\ninterface WalletSelectorContextValue {\n  selector: WalletSelector;\n  modal: WalletSelectorModal;\n  accounts: Array<AccountState>;\n  accountId: string | null;\n}\n\nconst WalletSelectorContext =\n  React.createContext<WalletSelectorContextValue | null>(null);\n\n// export const WalletSelectorContextProvider: React.FC<{\n//   children: ReactNode;\n// }> = ({ children }) => {\nexport function WalletSelectorContextProvider({\n  children\n}: {children: ReactNode}) {\n  const {chainId} = useActiveReact()\n  const [selector, setSelector] = useState<WalletSelector | null>(null);\n  const [modal, setModal] = useState<WalletSelectorModal | null>(null);\n  const [accounts, setAccounts] = useState<Array<AccountState>>([]);\n\n  const init = useCallback(async () => {\n    const _selector = await setupWalletSelector({\n      // network: \"testnet\",\n      network: chainId === ChainId.NEAR ? \"mainnet\" : 'testnet',\n      debug: true,\n      modules: [\n        // setupNearWallet(),\n        // setupMyNearWallet(),\n        setupSender(),\n        // setupHereWallet(),\n        // setupMathWallet(),\n        setupNightly(),\n        setupMeteorWallet(),\n        // setupNearSnap(),\n        // setupNarwallets(),\n        // setupWelldoneWallet(),\n        // setupLedger(),\n        // setupNearFi(),\n        // setupCoin98Wallet(),\n        // setupOptoWallet(),\n        // setupFinerWallet(),\n        // setupNeth(),\n        // setupXDEFI(),\n        // setupWalletConnect({\n        //   projectId: \"c4f79cc...\",\n        //   metadata: {\n        //     name: \"NEAR Wallet Selector\",\n        //     description: \"Example dApp used by NEAR Wallet Selector\",\n        //     url: \"https://github.com/near/wallet-selector\",\n        //     icons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n        //   },\n        // }),\n        // setupNightlyConnect({\n        //   url: \"wss://relay.nightly.app/app\",\n        //   appMetadata: {\n        //     additionalInfo: \"\",\n        //     application: \"NEAR Wallet Selector\",\n        //     description: \"Example dApp used by NEAR Wallet Selector\",\n        //     icon: \"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\",\n        //   },\n        // }),\n      ],\n    });\n    const _modal = setupModal(_selector, {\n      contractId: \"guest-book.testnet\",\n    });\n    const state = _selector.store.getState();\n    setAccounts(state.accounts);\n\n    window.selector = _selector;\n    window.modal = _modal;\n\n    setSelector(_selector);\n    setModal(_modal);\n  }, []);\n\n  useEffect(() => {\n    init().catch((err) => {\n      console.error(err);\n      alert(\"Failed to initialise wallet selector\");\n    });\n  }, [init]);\n\n  useEffect(() => {\n    // console.log(selector)\n    if (!selector) {\n      return;\n    }\n\n    const subscription = selector.store.observable\n      .pipe(\n        map((state: any) => state.accounts),\n        distinctUntilChanged()\n      )\n      .subscribe((nextAccounts: any) => {\n        console.log(\"Accounts Update\", nextAccounts);\n\n        setAccounts(nextAccounts);\n      });\n\n    const onHideSubscription: any = modal ? modal.on(\"onHide\", ({ hideReason }) => {\n      console.log(`The reason for hiding the modal ${hideReason}`);\n    }) : undefined;\n\n    return () => {\n      subscription.unsubscribe();\n      onHideSubscription.remove();\n    };\n  }, [selector]);\n\n  if (!selector || !modal) {\n    return <>Loading</>;\n  }\n\n  const accountId =\n    accounts.find((account) => account.active)?.accountId || null;\n\n  // const handleSignOut = async () => {\n  //   const wallet = await selector.wallet();\n\n  //   wallet.signOut().catch((err) => {\n  //     console.log(\"Failed to sign out\");\n  //     console.error(err);\n  //   });\n  // };\n  // const handleSwitchWallet = () => {\n  //   modal.show();\n  // };\n  return (\n    <WalletSelectorContext.Provider\n      value={{\n        selector,\n        modal,\n        accounts,\n        accountId,\n      }}\n    >\n      {/* <div onClick={()=> handleSignOut()}>Out</div>\n      <div onClick={()=> handleSwitchWallet()}>Switch Wallet</div> */}\n      {children}\n    </WalletSelectorContext.Provider>\n  );\n};\n\nexport function useWalletSelector() {\n  const context = useContext(WalletSelectorContext);\n\n  if (!context) {\n    throw new Error(\n      \"useWalletSelector must be used within a WalletSelectorContextProvider\"\n    );\n  }\n\n  return context;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}