{"ast":null,"code":"import { useCallback, useEffect } from 'react';\nimport { useActiveReact } from '../../hooks/useActiveReact';\nimport useInterval from '../../hooks/useInterval';\nimport { useDispatch } from 'react-redux';\nimport { aptBalanceList } from './actions';\nimport { useLoginAptos,\n// useAptAllowance,\nuseAptosBalance } from './index';\nexport default function Updater() {\n  const {\n    chainId,\n    account\n  } = useActiveReact();\n  const dispatch = useDispatch();\n  // const {setAptAllowance} = useAptAllowance()\n  const {\n    loginAptos\n  } = useLoginAptos();\n  const {\n    getAptosResource\n  } = useAptosBalance();\n  const getBalance = useCallback(() => {\n    getAptosResource(chainId, account).then(res => {\n      const list = {};\n      // console.log(res)\n      if (res && !res.error_code) {\n        for (const obj of res) {\n          var _obj$data, _obj$data$coin;\n          const type = obj.type;\n          const token = type.replace('0x1::coin::CoinStore<', '').replace('>', '');\n          if (obj === null || obj === void 0 ? void 0 : (_obj$data = obj.data) === null || _obj$data === void 0 ? void 0 : (_obj$data$coin = _obj$data.coin) === null || _obj$data$coin === void 0 ? void 0 : _obj$data$coin.value) {\n            var _obj$data2, _obj$data2$coin;\n            list[token] = {\n              balance: obj === null || obj === void 0 ? void 0 : (_obj$data2 = obj.data) === null || _obj$data2 === void 0 ? void 0 : (_obj$data2$coin = _obj$data2.coin) === null || _obj$data2$coin === void 0 ? void 0 : _obj$data2$coin.value\n            };\n          }\n        }\n      }\n      // console.log(list)\n      dispatch(aptBalanceList({\n        list\n      }));\n    });\n  }, [account, chainId, dispatch]);\n  useEffect(() => {\n    // setAptAllowance('0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin',chainId, account)\n    // getAptosResource(chainId, '0xc7e368b409404fd9bd27c0f6317996a7d36d94804ff72322586af0fd973126a3', '0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin').then((res:any) => {\n    //   console.log(res)\n    // })\n    getBalance();\n  }, [account, chainId, dispatch]);\n  useInterval(getBalance, 1000 * 5);\n  const getAptosAddress = useCallback(() => {\n    loginAptos(chainId);\n  }, [chainId]);\n  useEffect(() => {\n    getAptosAddress();\n  }, [chainId]);\n  return null;\n}","map":{"version":3,"names":["useCallback","useEffect","useActiveReact","useInterval","useDispatch","aptBalanceList","useLoginAptos","useAptosBalance","Updater","chainId","account","dispatch","loginAptos","getAptosResource","getBalance","then","res","list","error_code","obj","_obj$data","_obj$data$coin","type","token","replace","data","coin","value","_obj$data2","_obj$data2$coin","balance","getAptosAddress"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/nonevm/apt/updater.ts"],"sourcesContent":["import { useCallback, useEffect } from 'react'\nimport { useActiveReact } from '../../hooks/useActiveReact'\nimport useInterval from '../../hooks/useInterval'\nimport { useDispatch } from 'react-redux'\nimport { AppDispatch } from '../../state'\nimport {aptBalanceList} from './actions'\n\nimport {\n  useLoginAptos,\n  // useAptAllowance,\n  useAptosBalance\n} from './index'\n\nexport default function Updater(): null {\n  const { chainId,account } = useActiveReact()\n  const dispatch = useDispatch<AppDispatch>()\n  // const {setAptAllowance} = useAptAllowance()\n  const {loginAptos} = useLoginAptos()\n  const {getAptosResource} = useAptosBalance()\n\n  const getBalance = useCallback(() => {\n    getAptosResource(chainId, account).then((res:any) => {\n      const list:any = {}\n      // console.log(res)\n      if (res && !res.error_code) {\n        for (const obj of res) {\n          const type = obj.type\n          const token = type.replace('0x1::coin::CoinStore<', '').replace('>', '')\n          if (obj?.data?.coin?.value) {\n            list[token] = {\n              balance: obj?.data?.coin?.value\n            }\n          }\n        }\n      }\n      // console.log(list)\n      dispatch(aptBalanceList({list}))\n    })\n  }, [account, chainId, dispatch])\n\n  useEffect(() => {\n    // setAptAllowance('0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin',chainId, account)\n    // getAptosResource(chainId, '0xc7e368b409404fd9bd27c0f6317996a7d36d94804ff72322586af0fd973126a3', '0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin').then((res:any) => {\n    //   console.log(res)\n    // })\n    getBalance()\n  }, [account, chainId, dispatch])\n\n  useInterval(getBalance, 1000 * 5)\n\n  const getAptosAddress = useCallback(() => {\n    loginAptos(chainId)\n  }, [chainId])\n\n  useEffect(() => {\n    getAptosAddress()\n  }, [chainId])\n\n  return null\n}"],"mappings":"AAAA,SAASA,WAAW,EAAEC,SAAS,QAAQ,OAAO;AAC9C,SAASC,cAAc,QAAQ,4BAA4B;AAC3D,OAAOC,WAAW,MAAM,yBAAyB;AACjD,SAASC,WAAW,QAAQ,aAAa;AAEzC,SAAQC,cAAc,QAAO,WAAW;AAExC,SACEC,aAAa;AACb;AACAC,eAAe,QACV,SAAS;AAEhB,eAAe,SAASC,OAAOA,CAAA,EAAS;EACtC,MAAM;IAAEC,OAAO;IAACC;EAAQ,CAAC,GAAGR,cAAc,CAAC,CAAC;EAC5C,MAAMS,QAAQ,GAAGP,WAAW,CAAc,CAAC;EAC3C;EACA,MAAM;IAACQ;EAAU,CAAC,GAAGN,aAAa,CAAC,CAAC;EACpC,MAAM;IAACO;EAAgB,CAAC,GAAGN,eAAe,CAAC,CAAC;EAE5C,MAAMO,UAAU,GAAGd,WAAW,CAAC,MAAM;IACnCa,gBAAgB,CAACJ,OAAO,EAAEC,OAAO,CAAC,CAACK,IAAI,CAAEC,GAAO,IAAK;MACnD,MAAMC,IAAQ,GAAG,CAAC,CAAC;MACnB;MACA,IAAID,GAAG,IAAI,CAACA,GAAG,CAACE,UAAU,EAAE;QAC1B,KAAK,MAAMC,GAAG,IAAIH,GAAG,EAAE;UAAA,IAAAI,SAAA,EAAAC,cAAA;UACrB,MAAMC,IAAI,GAAGH,GAAG,CAACG,IAAI;UACrB,MAAMC,KAAK,GAAGD,IAAI,CAACE,OAAO,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC;UACxE,IAAIL,GAAG,aAAHA,GAAG,wBAAAC,SAAA,GAAHD,GAAG,CAAEM,IAAI,cAAAL,SAAA,wBAAAC,cAAA,GAATD,SAAA,CAAWM,IAAI,cAAAL,cAAA,uBAAfA,cAAA,CAAiBM,KAAK,EAAE;YAAA,IAAAC,UAAA,EAAAC,eAAA;YAC1BZ,IAAI,CAACM,KAAK,CAAC,GAAG;cACZO,OAAO,EAAEX,GAAG,aAAHA,GAAG,wBAAAS,UAAA,GAAHT,GAAG,CAAEM,IAAI,cAAAG,UAAA,wBAAAC,eAAA,GAATD,UAAA,CAAWF,IAAI,cAAAG,eAAA,uBAAfA,eAAA,CAAiBF;YAC5B,CAAC;UACH;QACF;MACF;MACA;MACAhB,QAAQ,CAACN,cAAc,CAAC;QAACY;MAAI,CAAC,CAAC,CAAC;IAClC,CAAC,CAAC;EACJ,CAAC,EAAE,CAACP,OAAO,EAAED,OAAO,EAAEE,QAAQ,CAAC,CAAC;EAEhCV,SAAS,CAAC,MAAM;IACd;IACA;IACA;IACA;IACAa,UAAU,CAAC,CAAC;EACd,CAAC,EAAE,CAACJ,OAAO,EAAED,OAAO,EAAEE,QAAQ,CAAC,CAAC;EAEhCR,WAAW,CAACW,UAAU,EAAE,IAAI,GAAG,CAAC,CAAC;EAEjC,MAAMiB,eAAe,GAAG/B,WAAW,CAAC,MAAM;IACxCY,UAAU,CAACH,OAAO,CAAC;EACrB,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAEbR,SAAS,CAAC,MAAM;IACd8B,eAAe,CAAC,CAAC;EACnB,CAAC,EAAE,CAACtB,OAAO,CAAC,CAAC;EAEb,OAAO,IAAI;AACb"},"metadata":{},"sourceType":"module","externalDependencies":[]}