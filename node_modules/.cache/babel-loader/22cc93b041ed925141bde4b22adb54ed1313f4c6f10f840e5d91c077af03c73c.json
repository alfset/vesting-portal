{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import LazyloadService from'./LazyloadService';export const LazyList=_ref=>{let{pageSize,records,list:List,boxRef,watchRef,children}=_ref;const size=pageSize||20;const[page,setPage]=useState(1);const[loadService,setLoadService]=useState();useEffect(()=>{let service;if(!boxRef||boxRef&&(boxRef===null||boxRef===void 0?void 0:boxRef.current)){service=LazyloadService.createElementObserve((boxRef===null||boxRef===void 0?void 0:boxRef.current)||null);setLoadService(service);}return()=>{if(service){service.disconnect();setLoadService(undefined);}};},[]);const[pageCount,isLimit]=useMemo(()=>{const count=Math.ceil(records.length/size)||1;const limit=page>=count;return[count,limit];},[records,size,page]);useEffect(()=>{// eslint-disable-next-line @typescript-eslint/ban-types\nlet unsubscribe;if(!isLimit&&loadService&&(watchRef===null||watchRef===void 0?void 0:watchRef.current)){unsubscribe=loadService.subscribe(watchRef===null||watchRef===void 0?void 0:watchRef.current,e=>{if(e&&e.intersectionRatio&&page<pageCount){setPage(page+1);}});}return()=>{if(unsubscribe){unsubscribe();}};},[loadService,page,pageCount,isLimit]);const currentRecords=useMemo(()=>{return records?records.slice(0,page*size):records;},[records,page,size]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(List,{records:currentRecords}),!isLimit?children:null);};","map":{"version":3,"names":["React","useState","useEffect","useMemo","LazyloadService","LazyList","_ref","pageSize","records","list","List","boxRef","watchRef","children","size","page","setPage","loadService","setLoadService","service","current","createElementObserve","disconnect","undefined","pageCount","isLimit","count","Math","ceil","length","limit","unsubscribe","subscribe","e","intersectionRatio","currentRecords","slice","createElement","Fragment"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/components/Lazyload/LazyList.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, RefObject, PropsWithChildren } from 'react';\nimport LazyloadService from './LazyloadService';\n\ntype Props = {\n  pageSize?: number;\n  records: any[];\n  list: any;\n  boxRef?: RefObject<any>;\n  watchRef?: RefObject<any>;\n}\n\nexport const LazyList = ({ pageSize, records, list: List, boxRef, watchRef, children}: PropsWithChildren<Props>) => {\n  const size = pageSize || 20;\n  const [page, setPage] = useState<number>(1);\n  const [loadService, setLoadService] = useState<LazyloadService>();\n\n  useEffect(() => {\n    let service: LazyloadService;\n    if (!boxRef || (boxRef && boxRef?.current)) {\n      service = LazyloadService.createElementObserve(boxRef?.current || null);\n      setLoadService(service);\n    }\n    return () => {\n      if (service) {\n        service.disconnect();\n        setLoadService(undefined);\n      }\n    }\n  }, []);\n\n  const [pageCount, isLimit] = useMemo(() => {\n    const count: any = Math.ceil(records.length / size) || 1;\n    const limit: any = page >= count;\n    return [count, limit];\n  }, [records, size, page]);\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    let unsubscribe: Function;\n    if (!isLimit && loadService && watchRef?.current) {\n      unsubscribe = loadService.subscribe(watchRef?.current, (e: any) => {\n        if (e && e.intersectionRatio && page < pageCount) {\n          setPage(page + 1);\n        }\n      })\n    }\n    return () => {\n      if (unsubscribe) {\n        unsubscribe();\n      }\n    }\n  }, [loadService, page, pageCount, isLimit]);\n\n  const currentRecords = useMemo(() => {\n    return records ? records.slice(0, page * size) : records;\n  }, [records, page, size]);\n\n  return (<>\n    <List records={ currentRecords }/>\n    { !isLimit ? children : null }\n  </>)\n}"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,OAAO,KAAsC,OAAO,CACzF,MAAO,CAAAC,eAAe,KAAM,mBAAmB,CAU/C,MAAO,MAAM,CAAAC,QAAQ,CAAGC,IAAA,EAA4F,IAA3F,CAAEC,QAAQ,CAAEC,OAAO,CAAEC,IAAI,CAAEC,IAAI,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,QAAkC,CAAC,CAAAP,IAAA,CAC7G,KAAM,CAAAQ,IAAI,CAAGP,QAAQ,EAAI,EAAE,CAC3B,KAAM,CAACQ,IAAI,CAAEC,OAAO,CAAC,CAAGf,QAAQ,CAAS,CAAC,CAAC,CAC3C,KAAM,CAACgB,WAAW,CAAEC,cAAc,CAAC,CAAGjB,QAAQ,CAAkB,CAAC,CAEjEC,SAAS,CAAC,IAAM,CACd,GAAI,CAAAiB,OAAwB,CAC5B,GAAI,CAACR,MAAM,EAAKA,MAAM,GAAIA,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAES,OAAO,CAAC,CAAE,CAC1CD,OAAO,CAAGf,eAAe,CAACiB,oBAAoB,CAAC,CAAAV,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAES,OAAO,GAAI,IAAI,CAAC,CACvEF,cAAc,CAACC,OAAO,CAAC,CACzB,CACA,MAAO,IAAM,CACX,GAAIA,OAAO,CAAE,CACXA,OAAO,CAACG,UAAU,CAAC,CAAC,CACpBJ,cAAc,CAACK,SAAS,CAAC,CAC3B,CACF,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAACC,SAAS,CAAEC,OAAO,CAAC,CAAGtB,OAAO,CAAC,IAAM,CACzC,KAAM,CAAAuB,KAAU,CAAGC,IAAI,CAACC,IAAI,CAACpB,OAAO,CAACqB,MAAM,CAAGf,IAAI,CAAC,EAAI,CAAC,CACxD,KAAM,CAAAgB,KAAU,CAAGf,IAAI,EAAIW,KAAK,CAChC,MAAO,CAACA,KAAK,CAAEI,KAAK,CAAC,CACvB,CAAC,CAAE,CAACtB,OAAO,CAAEM,IAAI,CAAEC,IAAI,CAAC,CAAC,CAEzBb,SAAS,CAAC,IAAM,CACd;AACA,GAAI,CAAA6B,WAAqB,CACzB,GAAI,CAACN,OAAO,EAAIR,WAAW,GAAIL,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEQ,OAAO,EAAE,CAChDW,WAAW,CAAGd,WAAW,CAACe,SAAS,CAACpB,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEQ,OAAO,CAAGa,CAAM,EAAK,CACjE,GAAIA,CAAC,EAAIA,CAAC,CAACC,iBAAiB,EAAInB,IAAI,CAAGS,SAAS,CAAE,CAChDR,OAAO,CAACD,IAAI,CAAG,CAAC,CAAC,CACnB,CACF,CAAC,CAAC,CACJ,CACA,MAAO,IAAM,CACX,GAAIgB,WAAW,CAAE,CACfA,WAAW,CAAC,CAAC,CACf,CACF,CAAC,CACH,CAAC,CAAE,CAACd,WAAW,CAAEF,IAAI,CAAES,SAAS,CAAEC,OAAO,CAAC,CAAC,CAE3C,KAAM,CAAAU,cAAc,CAAGhC,OAAO,CAAC,IAAM,CACnC,MAAO,CAAAK,OAAO,CAAGA,OAAO,CAAC4B,KAAK,CAAC,CAAC,CAAErB,IAAI,CAAGD,IAAI,CAAC,CAAGN,OAAO,CAC1D,CAAC,CAAE,CAACA,OAAO,CAAEO,IAAI,CAAED,IAAI,CAAC,CAAC,CAEzB,mBAAQd,KAAA,CAAAqC,aAAA,CAAArC,KAAA,CAAAsC,QAAA,mBACNtC,KAAA,CAAAqC,aAAA,CAAC3B,IAAI,EAACF,OAAO,CAAG2B,cAAgB,CAAC,CAAC,CAChC,CAACV,OAAO,CAAGZ,QAAQ,CAAG,IACxB,CAAC,CACL,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}