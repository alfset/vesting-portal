{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StellarTomlResolver = exports.STELLAR_TOML_MAX_SIZE = void 0;\nvar tslib_1 = require(\"tslib\");\nvar axios_1 = tslib_1.__importDefault(require(\"axios\"));\nvar toml_1 = tslib_1.__importDefault(require(\"toml\"));\nvar config_1 = require(\"./config\");\nexports.STELLAR_TOML_MAX_SIZE = 100 * 1024;\nvar CancelToken = axios_1.default.CancelToken;\nvar StellarTomlResolver = function () {\n  function StellarTomlResolver() {}\n  StellarTomlResolver.resolve = function (domain, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var allowHttp, timeout, protocol;\n      return tslib_1.__generator(this, function (_a) {\n        allowHttp = typeof opts.allowHttp === \"undefined\" ? config_1.Config.isAllowHttp() : opts.allowHttp;\n        timeout = typeof opts.timeout === \"undefined\" ? config_1.Config.getTimeout() : opts.timeout;\n        protocol = allowHttp ? \"http\" : \"https\";\n        return [2, axios_1.default.get(protocol + \"://\" + domain + \"/.well-known/stellar.toml\", {\n          maxContentLength: exports.STELLAR_TOML_MAX_SIZE,\n          cancelToken: timeout ? new CancelToken(function (cancel) {\n            return setTimeout(function () {\n              return cancel(\"timeout of \" + timeout + \"ms exceeded\");\n            }, timeout);\n          }) : undefined,\n          timeout: timeout\n        }).then(function (response) {\n          try {\n            var tomlObject = toml_1.default.parse(response.data);\n            return Promise.resolve(tomlObject);\n          } catch (e) {\n            return Promise.reject(new Error(\"stellar.toml is invalid - Parsing error on line \" + e.line + \", column \" + e.column + \": \" + e.message));\n          }\n        }).catch(function (err) {\n          if (err.message.match(/^maxContentLength size/)) {\n            throw new Error(\"stellar.toml file exceeds allowed size of \" + exports.STELLAR_TOML_MAX_SIZE);\n          } else {\n            throw err;\n          }\n        })];\n      });\n    });\n  };\n  return StellarTomlResolver;\n}();\nexports.StellarTomlResolver = StellarTomlResolver;","map":{"version":3,"names":["axios_1","tslib_1","__importDefault","require","toml_1","config_1","exports","STELLAR_TOML_MAX_SIZE","CancelToken","default","StellarTomlResolver","resolve","domain","opts","allowHttp","Config","isAllowHttp","timeout","getTimeout","protocol","get","maxContentLength","cancelToken","cancel","setTimeout","undefined","then","response","tomlObject","parse","data","Promise","e","reject","Error","line","column","message","catch","err","match"],"sources":["../src/stellar_toml_resolver.ts"],"sourcesContent":[null],"mappings":";;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA,CAAAC,eAAA,CAAAC,OAAA;AAEA,IAAAC,MAAA,GAAAH,OAAA,CAAAC,eAAA,CAAAC,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AAGaG,OAAA,CAAAC,qBAAqB,GAAG,GAAG,GAAG,IAAI;AAI/C,IAAMC,WAAW,GAAGR,OAAA,CAAAS,OAAK,CAACD,WAAW;AAKrC,IAAAE,mBAAA;EAAA,SAAAA,oBAAA,GAoEA;EAjDsBA,mBAAA,CAAAC,OAAO,GAA3B,UACEC,MAAc,EACdC,IAAwD;IAAxD,IAAAA,IAAA;MAAAA,IAAA,KAAwD;IAAA;;;;QAElDC,SAAS,GACb,OAAOD,IAAI,CAACC,SAAS,KAAK,WAAW,GACjCT,QAAA,CAAAU,MAAM,CAACC,WAAW,EAAE,GACpBH,IAAI,CAACC,SAAS;QAEdG,OAAO,GACX,OAAOJ,IAAI,CAACI,OAAO,KAAK,WAAW,GAAGZ,QAAA,CAAAU,MAAM,CAACG,UAAU,EAAE,GAAGL,IAAI,CAACI,OAAO;QAEpEE,QAAQ,GAAGL,SAAS,GAAG,MAAM,GAAG,OAAO;QAE7C,WAAOd,OAAA,CAAAS,OAAK,CACTW,GAAG,CAAID,QAAQ,WAAMP,MAAM,8BAA2B,EAAE;UACvDS,gBAAgB,EAAEf,OAAA,CAAAC,qBAAqB;UACvCe,WAAW,EAAEL,OAAO,GAChB,IAAIT,WAAW,CAAC,UAACe,MAAM;YACrB,OAAAC,UAAU,CACR;cAAM,OAAAD,MAAM,CAAC,gBAAcN,OAAO,gBAAa,CAAC;YAA1C,CAA0C,EAChDA,OAAO,CACR;UAHD,CAGC,CACF,GACDQ,SAAS;UACbR,OAAO,EAAAA;SACR,CAAC,CACDS,IAAI,CAAC,UAACC,QAAQ;UACb,IAAI;YACF,IAAMC,UAAU,GAAGxB,MAAA,CAAAK,OAAI,CAACoB,KAAK,CAACF,QAAQ,CAACG,IAAI,CAAC;YAC5C,OAAOC,OAAO,CAACpB,OAAO,CAACiB,UAAU,CAAC;WACnC,CAAC,OAAOI,CAAC,EAAE;YACV,OAAOD,OAAO,CAACE,MAAM,CACnB,IAAIC,KAAK,CACP,qDAAmDF,CAAC,CAACG,IAAI,iBAAYH,CAAC,CAACI,MAAM,UAAKJ,CAAC,CAACK,OAAS,CAC9F,CACF;;QAEL,CAAC,CAAC,CACDC,KAAK,CAAC,UAACC,GAAU;UAChB,IAAIA,GAAG,CAACF,OAAO,CAACG,KAAK,CAAC,wBAAwB,CAAC,EAAE;YAC/C,MAAM,IAAIN,KAAK,CACb,+CAA6C5B,OAAA,CAAAC,qBAAuB,CACrE;WACF,MAAM;YACL,MAAMgC,GAAG;;QAEb,CAAC,CAAC;;;GACL;EACH,OAAA7B,mBAAC;AAAD,CAAC,CApED;AAAaJ,OAAA,CAAAI,mBAAA,GAAAA,mBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}