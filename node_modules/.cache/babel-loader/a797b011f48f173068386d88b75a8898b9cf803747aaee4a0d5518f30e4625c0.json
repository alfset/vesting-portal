{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCurrentServerTime = exports.SERVER_TIME_MAP = void 0;\nvar tslib_1 = require(\"tslib\");\nvar axios_1 = tslib_1.__importDefault(require(\"axios\"));\nvar urijs_1 = tslib_1.__importDefault(require(\"urijs\"));\nvar version = require(\"../package.json\").version;\nexports.SERVER_TIME_MAP = {};\nvar HorizonAxiosClient = axios_1.default.create({\n  headers: {\n    \"X-Client-Name\": \"js-stellar-sdk\",\n    \"X-Client-Version\": version\n  }\n});\nfunction _toSeconds(ms) {\n  return Math.floor(ms / 1000);\n}\nHorizonAxiosClient.interceptors.response.use(function interceptorHorizonResponse(response) {\n  var hostname = urijs_1.default(response.config.url).hostname();\n  var serverTime = _toSeconds(Date.parse(response.headers.date));\n  var localTimeRecorded = _toSeconds(new Date().getTime());\n  if (!isNaN(serverTime)) {\n    exports.SERVER_TIME_MAP[hostname] = {\n      serverTime: serverTime,\n      localTimeRecorded: localTimeRecorded\n    };\n  }\n  return response;\n});\nexports.default = HorizonAxiosClient;\nfunction getCurrentServerTime(hostname) {\n  var entry = exports.SERVER_TIME_MAP[hostname];\n  if (!entry || !entry.localTimeRecorded || !entry.serverTime) {\n    return null;\n  }\n  var serverTime = entry.serverTime,\n    localTimeRecorded = entry.localTimeRecorded;\n  var currentTime = _toSeconds(new Date().getTime());\n  if (currentTime - localTimeRecorded > 60 * 5) {\n    return null;\n  }\n  return currentTime - localTimeRecorded + serverTime;\n}\nexports.getCurrentServerTime = getCurrentServerTime;","map":{"version":3,"names":["axios_1","tslib_1","__importDefault","require","urijs_1","version","exports","SERVER_TIME_MAP","HorizonAxiosClient","default","create","headers","_toSeconds","ms","Math","floor","interceptors","response","use","interceptorHorizonResponse","hostname","config","url","serverTime","Date","parse","date","localTimeRecorded","getTime","isNaN","getCurrentServerTime","entry","currentTime"],"sources":["../src/horizon_axios_client.ts"],"sourcesContent":[null],"mappings":";;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA,CAAAC,eAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAH,OAAA,CAAAC,eAAA,CAAAC,OAAA;AAGA,IAAME,OAAO,GAAGF,OAAO,CAAC,iBAAiB,CAAC,CAACE,OAAO;AAmBrCC,OAAA,CAAAC,eAAe,GAA+B,EAAE;AAE7D,IAAMC,kBAAkB,GAAGR,OAAA,CAAAS,OAAK,CAACC,MAAM,CAAC;EACtCC,OAAO,EAAE;IACP,eAAe,EAAE,gBAAgB;IACjC,kBAAkB,EAAEN;;CAEvB,CAAC;AAEF,SAASO,UAAUA,CAACC,EAAU;EAC5B,OAAOC,IAAI,CAACC,KAAK,CAACF,EAAE,GAAG,IAAI,CAAC;AAC9B;AAEAL,kBAAkB,CAACQ,YAAY,CAACC,QAAQ,CAACC,GAAG,CAC1C,SAASC,0BAA0BA,CAACF,QAAuB;EACzD,IAAMG,QAAQ,GAAGhB,OAAA,CAAAK,OAAG,CAACQ,QAAQ,CAACI,MAAM,CAACC,GAAI,CAAC,CAACF,QAAQ,EAAE;EACrD,IAAMG,UAAU,GAAGX,UAAU,CAACY,IAAI,CAACC,KAAK,CAACR,QAAQ,CAACN,OAAO,CAACe,IAAI,CAAC,CAAC;EAChE,IAAMC,iBAAiB,GAAGf,UAAU,CAAC,IAAIY,IAAI,EAAE,CAACI,OAAO,EAAE,CAAC;EAE1D,IAAI,CAACC,KAAK,CAACN,UAAU,CAAC,EAAE;IACtBjB,OAAA,CAAAC,eAAe,CAACa,QAAQ,CAAC,GAAG;MAC1BG,UAAU,EAAAA,UAAA;MACVI,iBAAiB,EAAAA;KAClB;;EAGH,OAAOV,QAAQ;AACjB,CAAC,CACF;AAEDX,OAAA,CAAAG,OAAA,GAAeD,kBAAkB;AAWjC,SAAgBsB,oBAAoBA,CAACV,QAAgB;EACnD,IAAMW,KAAK,GAAGzB,OAAA,CAAAC,eAAe,CAACa,QAAQ,CAAC;EAEvC,IAAI,CAACW,KAAK,IAAI,CAACA,KAAK,CAACJ,iBAAiB,IAAI,CAACI,KAAK,CAACR,UAAU,EAAE;IAC3D,OAAO,IAAI;;EAGL,IAAAA,UAAU,GAAwBQ,KAAK,CAAAR,UAA7B;IAAEI,iBAAiB,GAAKI,KAAK,CAAAJ,iBAAV;EACrC,IAAMK,WAAW,GAAGpB,UAAU,CAAC,IAAIY,IAAI,EAAE,CAACI,OAAO,EAAE,CAAC;EAGpD,IAAII,WAAW,GAAGL,iBAAiB,GAAG,EAAE,GAAG,CAAC,EAAE;IAC5C,OAAO,IAAI;;EAGb,OAAOK,WAAW,GAAGL,iBAAiB,GAAGJ,UAAU;AACrD;AAhBAjB,OAAA,CAAAwB,oBAAA,GAAAA,oBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}