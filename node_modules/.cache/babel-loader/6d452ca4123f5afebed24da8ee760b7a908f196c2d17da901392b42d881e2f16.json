{"ast":null,"code":"'use strict';\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Account2FA = exports.AccountMultisig = exports.MULTISIG_CONFIRM_METHODS = exports.MULTISIG_CHANGE_METHODS = exports.MULTISIG_DEPOSIT = exports.MULTISIG_GAS = exports.MULTISIG_ALLOWANCE = exports.MULTISIG_STORAGE_KEY = void 0;\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst depd_1 = __importDefault(require(\"depd\"));\nconst account_1 = require(\"./account\");\nconst format_1 = require(\"./utils/format\");\nconst key_pair_1 = require(\"./utils/key_pair\");\nconst transaction_1 = require(\"./transaction\");\nconst web_1 = require(\"./utils/web\");\nexports.MULTISIG_STORAGE_KEY = '__multisigRequest';\nexports.MULTISIG_ALLOWANCE = new bn_js_1.default(format_1.parseNearAmount('1'));\n// TODO: Different gas value for different requests (can reduce gas usage dramatically)\nexports.MULTISIG_GAS = new bn_js_1.default('100000000000000');\nexports.MULTISIG_DEPOSIT = new bn_js_1.default('0');\nexports.MULTISIG_CHANGE_METHODS = ['add_request', 'add_request_and_confirm', 'delete_request', 'confirm'];\nexports.MULTISIG_CONFIRM_METHODS = ['confirm'];\n// in memory request cache for node w/o localStorage\nconst storageFallback = {\n  [exports.MULTISIG_STORAGE_KEY]: null\n};\nclass AccountMultisig extends account_1.Account {\n  constructor(connection, accountId, options) {\n    super(connection, accountId);\n    this.storage = options.storage;\n    this.onAddRequestResult = options.onAddRequestResult;\n  }\n  async signAndSendTransactionWithAccount(receiverId, actions) {\n    return super.signAndSendTransaction({\n      receiverId,\n      actions\n    });\n  }\n  signAndSendTransaction() {\n    if (typeof (arguments.length <= 0 ? undefined : arguments[0]) === 'string') {\n      return this._signAndSendTransaction({\n        receiverId: arguments.length <= 0 ? undefined : arguments[0],\n        actions: arguments.length <= 1 ? undefined : arguments[1]\n      });\n    }\n    return this._signAndSendTransaction(arguments.length <= 0 ? undefined : arguments[0]);\n  }\n  async _signAndSendTransaction(_ref) {\n    let {\n      receiverId,\n      actions\n    } = _ref;\n    const {\n      accountId\n    } = this;\n    const args = Buffer.from(JSON.stringify({\n      request: {\n        receiver_id: receiverId,\n        actions: convertActions(actions, accountId, receiverId)\n      }\n    }));\n    let result;\n    try {\n      result = await super.signAndSendTransaction({\n        receiverId: accountId,\n        actions: [transaction_1.functionCall('add_request_and_confirm', args, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n      });\n    } catch (e) {\n      if (e.toString().includes('Account has too many active requests. Confirm or delete some')) {\n        await this.deleteUnconfirmedRequests();\n        return await this.signAndSendTransaction(receiverId, actions);\n      }\n      throw e;\n    }\n    // TODO: Are following even needed? Seems like it throws on error already\n    if (!result.status) {\n      throw new Error('Request failed');\n    }\n    const status = {\n      ...result.status\n    };\n    if (!status.SuccessValue || typeof status.SuccessValue !== 'string') {\n      throw new Error('Request failed');\n    }\n    this.setRequest({\n      accountId,\n      actions,\n      requestId: parseInt(Buffer.from(status.SuccessValue, 'base64').toString('ascii'), 10)\n    });\n    if (this.onAddRequestResult) {\n      await this.onAddRequestResult(result);\n    }\n    // NOTE there is no await on purpose to avoid blocking for 2fa\n    this.deleteUnconfirmedRequests();\n    return result;\n  }\n  async deleteUnconfirmedRequests() {\n    // TODO: Delete in batch, don't delete unexpired\n    // TODO: Delete in batch, don't delete unexpired (can reduce gas usage dramatically)\n    const request_ids = await this.getRequestIds();\n    const {\n      requestId\n    } = this.getRequest();\n    for (const requestIdToDelete of request_ids) {\n      if (requestIdToDelete == requestId) {\n        continue;\n      }\n      try {\n        await super.signAndSendTransaction({\n          receiverId: this.accountId,\n          actions: [transaction_1.functionCall('delete_request', {\n            request_id: requestIdToDelete\n          }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n        });\n      } catch (e) {\n        console.warn('Attempt to delete an earlier request before 15 minutes failed. Will try again.');\n      }\n    }\n  }\n  // helpers\n  async getRequestIds() {\n    // TODO: Read requests from state to allow filtering by expiration time\n    // TODO: https://github.com/near/core-contracts/blob/305d1db4f4f2cf5ce4c1ef3479f7544957381f11/multisig/src/lib.rs#L84\n    return this.viewFunction(this.accountId, 'list_request_ids');\n  }\n  getRequest() {\n    if (this.storage) {\n      return JSON.parse(this.storage.getItem(exports.MULTISIG_STORAGE_KEY) || '{}');\n    }\n    return storageFallback[exports.MULTISIG_STORAGE_KEY];\n  }\n  setRequest(data) {\n    if (this.storage) {\n      return this.storage.setItem(exports.MULTISIG_STORAGE_KEY, JSON.stringify(data));\n    }\n    storageFallback[exports.MULTISIG_STORAGE_KEY] = data;\n  }\n}\nexports.AccountMultisig = AccountMultisig;\nclass Account2FA extends AccountMultisig {\n  constructor(connection, accountId, options) {\n    super(connection, accountId, options);\n    this.helperUrl = 'https://helper.testnet.near.org';\n    this.helperUrl = options.helperUrl || this.helperUrl;\n    this.storage = options.storage;\n    this.sendCode = options.sendCode || this.sendCodeDefault;\n    this.getCode = options.getCode || this.getCodeDefault;\n    this.verifyCode = options.verifyCode || this.verifyCodeDefault;\n    this.onConfirmResult = options.onConfirmResult;\n  }\n  async signAndSendTransaction() {\n    if (typeof (arguments.length <= 0 ? undefined : arguments[0]) === 'string') {\n      const deprecate = depd_1.default('Account.signAndSendTransaction(receiverId, actions');\n      deprecate('use `Account2FA.signAndSendTransaction(SignAndSendTransactionOptions)` instead');\n      return this.__signAndSendTransaction({\n        receiverId: arguments.length <= 0 ? undefined : arguments[0],\n        actions: arguments.length <= 1 ? undefined : arguments[1]\n      });\n    } else {\n      return this.__signAndSendTransaction(arguments.length <= 0 ? undefined : arguments[0]);\n    }\n  }\n  async __signAndSendTransaction(_ref2) {\n    let {\n      receiverId,\n      actions\n    } = _ref2;\n    await super.signAndSendTransaction({\n      receiverId,\n      actions\n    });\n    // TODO: Should following override onRequestResult in superclass instead of doing custom signAndSendTransaction?\n    await this.sendCode();\n    const result = await this.promptAndVerify();\n    if (this.onConfirmResult) {\n      await this.onConfirmResult(result);\n    }\n    return result;\n  }\n  // default helpers for CH deployments of multisig\n  async deployMultisig(contractBytes) {\n    const {\n      accountId\n    } = this;\n    const seedOrLedgerKey = (await this.getRecoveryMethods()).data.filter(_ref3 => {\n      let {\n        kind,\n        publicKey\n      } = _ref3;\n      return (kind === 'phrase' || kind === 'ledger') && publicKey !== null;\n    }).map(rm => rm.publicKey);\n    const fak2lak = (await this.getAccessKeys()).filter(_ref4 => {\n      let {\n        public_key,\n        access_key: {\n          permission\n        }\n      } = _ref4;\n      return permission === 'FullAccess' && !seedOrLedgerKey.includes(public_key);\n    }).map(ak => ak.public_key).map(toPK);\n    const confirmOnlyKey = toPK((await this.postSignedJson('/2fa/getAccessKey', {\n      accountId\n    })).publicKey);\n    const newArgs = Buffer.from(JSON.stringify({\n      'num_confirmations': 2\n    }));\n    const actions = [...fak2lak.map(pk => transaction_1.deleteKey(pk)), ...fak2lak.map(pk => transaction_1.addKey(pk, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CHANGE_METHODS, null))), transaction_1.addKey(confirmOnlyKey, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CONFIRM_METHODS, null)), transaction_1.deployContract(contractBytes)];\n    if ((await this.state()).code_hash === '11111111111111111111111111111111') {\n      actions.push(transaction_1.functionCall('new', newArgs, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT));\n    }\n    console.log('deploying multisig contract for', accountId);\n    return await super.signAndSendTransactionWithAccount(accountId, actions);\n  }\n  async disable(contractBytes) {\n    const {\n      accountId\n    } = this;\n    const accessKeys = await this.getAccessKeys();\n    const lak2fak = accessKeys.filter(_ref5 => {\n      let {\n        access_key\n      } = _ref5;\n      return access_key.permission !== 'FullAccess';\n    }).filter(_ref6 => {\n      let {\n        access_key\n      } = _ref6;\n      const perm = access_key.permission.FunctionCall;\n      return perm.receiver_id === accountId && perm.method_names.length === 4 && perm.method_names.includes('add_request_and_confirm');\n    });\n    const confirmOnlyKey = key_pair_1.PublicKey.from((await this.postSignedJson('/2fa/getAccessKey', {\n      accountId\n    })).publicKey);\n    const actions = [transaction_1.deleteKey(confirmOnlyKey), ...lak2fak.map(_ref7 => {\n      let {\n        public_key\n      } = _ref7;\n      return transaction_1.deleteKey(key_pair_1.PublicKey.from(public_key));\n    }), ...lak2fak.map(_ref8 => {\n      let {\n        public_key\n      } = _ref8;\n      return transaction_1.addKey(key_pair_1.PublicKey.from(public_key), null);\n    }), transaction_1.deployContract(contractBytes)];\n    console.log('disabling 2fa for', accountId);\n    return await this.signAndSendTransaction({\n      receiverId: accountId,\n      actions\n    });\n  }\n  async sendCodeDefault() {\n    const {\n      accountId\n    } = this;\n    const {\n      requestId\n    } = this.getRequest();\n    const method = await this.get2faMethod();\n    await this.postSignedJson('/2fa/send', {\n      accountId,\n      method,\n      requestId\n    });\n    return requestId;\n  }\n  async getCodeDefault(method) {\n    throw new Error('There is no getCode callback provided. Please provide your own in AccountMultisig constructor options. It has a parameter method where method.kind is \"email\" or \"phone\".');\n  }\n  async promptAndVerify() {\n    const method = await this.get2faMethod();\n    const securityCode = await this.getCode(method);\n    try {\n      const result = await this.verifyCode(securityCode);\n      // TODO: Parse error from result for real (like in normal account.signAndSendTransaction)\n      return result;\n    } catch (e) {\n      console.warn('Error validating security code:', e);\n      if (e.toString().includes('invalid 2fa code provided') || e.toString().includes('2fa code not valid')) {\n        return await this.promptAndVerify();\n      }\n      throw e;\n    }\n  }\n  async verifyCodeDefault(securityCode) {\n    const {\n      accountId\n    } = this;\n    const request = this.getRequest();\n    if (!request) {\n      throw new Error('no request pending');\n    }\n    const {\n      requestId\n    } = request;\n    return await this.postSignedJson('/2fa/verify', {\n      accountId,\n      securityCode,\n      requestId\n    });\n  }\n  async getRecoveryMethods() {\n    const {\n      accountId\n    } = this;\n    return {\n      accountId,\n      data: await this.postSignedJson('/account/recoveryMethods', {\n        accountId\n      })\n    };\n  }\n  async get2faMethod() {\n    let {\n      data\n    } = await this.getRecoveryMethods();\n    if (data && data.length) {\n      data = data.find(m => m.kind.indexOf('2fa-') === 0);\n    }\n    if (!data) return null;\n    const {\n      kind,\n      detail\n    } = data;\n    return {\n      kind,\n      detail\n    };\n  }\n  async signatureFor() {\n    const {\n      accountId\n    } = this;\n    const block = await this.connection.provider.block({\n      finality: 'final'\n    });\n    const blockNumber = block.header.height.toString();\n    const signed = await this.connection.signer.signMessage(Buffer.from(blockNumber), accountId, this.connection.networkId);\n    const blockNumberSignature = Buffer.from(signed.signature).toString('base64');\n    return {\n      blockNumber,\n      blockNumberSignature\n    };\n  }\n  async postSignedJson(path, body) {\n    return await web_1.fetchJson(this.helperUrl + path, JSON.stringify({\n      ...body,\n      ...(await this.signatureFor())\n    }));\n  }\n}\nexports.Account2FA = Account2FA;\n// helpers\nconst toPK = pk => key_pair_1.PublicKey.from(pk);\nconst convertPKForContract = pk => pk.toString().replace('ed25519:', '');\nconst convertActions = (actions, accountId, receiverId) => actions.map(a => {\n  const type = a.enum;\n  const {\n    gas,\n    publicKey,\n    methodName,\n    args,\n    deposit,\n    accessKey,\n    code\n  } = a[type];\n  const action = {\n    type: type[0].toUpperCase() + type.substr(1),\n    gas: gas && gas.toString() || undefined,\n    public_key: publicKey && convertPKForContract(publicKey) || undefined,\n    method_name: methodName,\n    args: args && Buffer.from(args).toString('base64') || undefined,\n    code: code && Buffer.from(code).toString('base64') || undefined,\n    amount: deposit && deposit.toString() || undefined,\n    deposit: deposit && deposit.toString() || '0',\n    permission: undefined\n  };\n  if (accessKey) {\n    if (receiverId === accountId && accessKey.permission.enum !== 'fullAccess') {\n      action.permission = {\n        receiver_id: accountId,\n        allowance: exports.MULTISIG_ALLOWANCE.toString(),\n        method_names: exports.MULTISIG_CHANGE_METHODS\n      };\n    }\n    if (accessKey.permission.enum === 'functionCall') {\n      const {\n        receiverId: receiver_id,\n        methodNames: method_names,\n        allowance\n      } = accessKey.permission.functionCall;\n      action.permission = {\n        receiver_id,\n        allowance: allowance && allowance.toString() || undefined,\n        method_names\n      };\n    }\n  }\n  return action;\n});","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","Account2FA","AccountMultisig","MULTISIG_CONFIRM_METHODS","MULTISIG_CHANGE_METHODS","MULTISIG_DEPOSIT","MULTISIG_GAS","MULTISIG_ALLOWANCE","MULTISIG_STORAGE_KEY","bn_js_1","require","depd_1","account_1","format_1","key_pair_1","transaction_1","web_1","default","parseNearAmount","storageFallback","Account","constructor","connection","accountId","options","storage","onAddRequestResult","signAndSendTransactionWithAccount","receiverId","actions","signAndSendTransaction","arguments","length","undefined","_signAndSendTransaction","_ref","args","Buffer","from","JSON","stringify","request","receiver_id","convertActions","result","functionCall","e","toString","includes","deleteUnconfirmedRequests","status","Error","SuccessValue","setRequest","requestId","parseInt","request_ids","getRequestIds","getRequest","requestIdToDelete","request_id","console","warn","viewFunction","parse","getItem","data","setItem","helperUrl","sendCode","sendCodeDefault","getCode","getCodeDefault","verifyCode","verifyCodeDefault","onConfirmResult","deprecate","__signAndSendTransaction","_ref2","promptAndVerify","deployMultisig","contractBytes","seedOrLedgerKey","getRecoveryMethods","filter","_ref3","kind","publicKey","map","rm","fak2lak","getAccessKeys","_ref4","public_key","access_key","permission","ak","toPK","confirmOnlyKey","postSignedJson","newArgs","pk","deleteKey","addKey","functionCallAccessKey","deployContract","state","code_hash","push","log","disable","accessKeys","lak2fak","_ref5","_ref6","perm","FunctionCall","method_names","PublicKey","_ref7","_ref8","method","get2faMethod","securityCode","find","m","indexOf","detail","signatureFor","block","provider","finality","blockNumber","header","height","signed","signer","signMessage","networkId","blockNumberSignature","signature","path","body","fetchJson","convertPKForContract","replace","a","type","enum","gas","methodName","deposit","accessKey","code","action","toUpperCase","substr","method_name","amount","allowance","methodNames"],"sources":["/workspace/Planq-Dapps/vesting-portal/node_modules/near-api-js/lib/account_multisig.js"],"sourcesContent":["'use strict';\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Account2FA = exports.AccountMultisig = exports.MULTISIG_CONFIRM_METHODS = exports.MULTISIG_CHANGE_METHODS = exports.MULTISIG_DEPOSIT = exports.MULTISIG_GAS = exports.MULTISIG_ALLOWANCE = exports.MULTISIG_STORAGE_KEY = void 0;\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst depd_1 = __importDefault(require(\"depd\"));\nconst account_1 = require(\"./account\");\nconst format_1 = require(\"./utils/format\");\nconst key_pair_1 = require(\"./utils/key_pair\");\nconst transaction_1 = require(\"./transaction\");\nconst web_1 = require(\"./utils/web\");\nexports.MULTISIG_STORAGE_KEY = '__multisigRequest';\nexports.MULTISIG_ALLOWANCE = new bn_js_1.default(format_1.parseNearAmount('1'));\n// TODO: Different gas value for different requests (can reduce gas usage dramatically)\nexports.MULTISIG_GAS = new bn_js_1.default('100000000000000');\nexports.MULTISIG_DEPOSIT = new bn_js_1.default('0');\nexports.MULTISIG_CHANGE_METHODS = ['add_request', 'add_request_and_confirm', 'delete_request', 'confirm'];\nexports.MULTISIG_CONFIRM_METHODS = ['confirm'];\n// in memory request cache for node w/o localStorage\nconst storageFallback = {\n    [exports.MULTISIG_STORAGE_KEY]: null\n};\nclass AccountMultisig extends account_1.Account {\n    constructor(connection, accountId, options) {\n        super(connection, accountId);\n        this.storage = options.storage;\n        this.onAddRequestResult = options.onAddRequestResult;\n    }\n    async signAndSendTransactionWithAccount(receiverId, actions) {\n        return super.signAndSendTransaction({ receiverId, actions });\n    }\n    signAndSendTransaction(...args) {\n        if (typeof args[0] === 'string') {\n            return this._signAndSendTransaction({ receiverId: args[0], actions: args[1] });\n        }\n        return this._signAndSendTransaction(args[0]);\n    }\n    async _signAndSendTransaction({ receiverId, actions }) {\n        const { accountId } = this;\n        const args = Buffer.from(JSON.stringify({\n            request: {\n                receiver_id: receiverId,\n                actions: convertActions(actions, accountId, receiverId)\n            }\n        }));\n        let result;\n        try {\n            result = await super.signAndSendTransaction({\n                receiverId: accountId,\n                actions: [\n                    transaction_1.functionCall('add_request_and_confirm', args, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)\n                ]\n            });\n        }\n        catch (e) {\n            if (e.toString().includes('Account has too many active requests. Confirm or delete some')) {\n                await this.deleteUnconfirmedRequests();\n                return await this.signAndSendTransaction(receiverId, actions);\n            }\n            throw e;\n        }\n        // TODO: Are following even needed? Seems like it throws on error already\n        if (!result.status) {\n            throw new Error('Request failed');\n        }\n        const status = { ...result.status };\n        if (!status.SuccessValue || typeof status.SuccessValue !== 'string') {\n            throw new Error('Request failed');\n        }\n        this.setRequest({\n            accountId,\n            actions,\n            requestId: parseInt(Buffer.from(status.SuccessValue, 'base64').toString('ascii'), 10)\n        });\n        if (this.onAddRequestResult) {\n            await this.onAddRequestResult(result);\n        }\n        // NOTE there is no await on purpose to avoid blocking for 2fa\n        this.deleteUnconfirmedRequests();\n        return result;\n    }\n    async deleteUnconfirmedRequests() {\n        // TODO: Delete in batch, don't delete unexpired\n        // TODO: Delete in batch, don't delete unexpired (can reduce gas usage dramatically)\n        const request_ids = await this.getRequestIds();\n        const { requestId } = this.getRequest();\n        for (const requestIdToDelete of request_ids) {\n            if (requestIdToDelete == requestId) {\n                continue;\n            }\n            try {\n                await super.signAndSendTransaction({\n                    receiverId: this.accountId,\n                    actions: [transaction_1.functionCall('delete_request', { request_id: requestIdToDelete }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n                });\n            }\n            catch (e) {\n                console.warn('Attempt to delete an earlier request before 15 minutes failed. Will try again.');\n            }\n        }\n    }\n    // helpers\n    async getRequestIds() {\n        // TODO: Read requests from state to allow filtering by expiration time\n        // TODO: https://github.com/near/core-contracts/blob/305d1db4f4f2cf5ce4c1ef3479f7544957381f11/multisig/src/lib.rs#L84\n        return this.viewFunction(this.accountId, 'list_request_ids');\n    }\n    getRequest() {\n        if (this.storage) {\n            return JSON.parse(this.storage.getItem(exports.MULTISIG_STORAGE_KEY) || '{}');\n        }\n        return storageFallback[exports.MULTISIG_STORAGE_KEY];\n    }\n    setRequest(data) {\n        if (this.storage) {\n            return this.storage.setItem(exports.MULTISIG_STORAGE_KEY, JSON.stringify(data));\n        }\n        storageFallback[exports.MULTISIG_STORAGE_KEY] = data;\n    }\n}\nexports.AccountMultisig = AccountMultisig;\nclass Account2FA extends AccountMultisig {\n    constructor(connection, accountId, options) {\n        super(connection, accountId, options);\n        this.helperUrl = 'https://helper.testnet.near.org';\n        this.helperUrl = options.helperUrl || this.helperUrl;\n        this.storage = options.storage;\n        this.sendCode = options.sendCode || this.sendCodeDefault;\n        this.getCode = options.getCode || this.getCodeDefault;\n        this.verifyCode = options.verifyCode || this.verifyCodeDefault;\n        this.onConfirmResult = options.onConfirmResult;\n    }\n    async signAndSendTransaction(...args) {\n        if (typeof args[0] === 'string') {\n            const deprecate = depd_1.default('Account.signAndSendTransaction(receiverId, actions');\n            deprecate('use `Account2FA.signAndSendTransaction(SignAndSendTransactionOptions)` instead');\n            return this.__signAndSendTransaction({ receiverId: args[0], actions: args[1] });\n        }\n        else {\n            return this.__signAndSendTransaction(args[0]);\n        }\n    }\n    async __signAndSendTransaction({ receiverId, actions }) {\n        await super.signAndSendTransaction({ receiverId, actions });\n        // TODO: Should following override onRequestResult in superclass instead of doing custom signAndSendTransaction?\n        await this.sendCode();\n        const result = await this.promptAndVerify();\n        if (this.onConfirmResult) {\n            await this.onConfirmResult(result);\n        }\n        return result;\n    }\n    // default helpers for CH deployments of multisig\n    async deployMultisig(contractBytes) {\n        const { accountId } = this;\n        const seedOrLedgerKey = (await this.getRecoveryMethods()).data\n            .filter(({ kind, publicKey }) => (kind === 'phrase' || kind === 'ledger') && publicKey !== null)\n            .map((rm) => rm.publicKey);\n        const fak2lak = (await this.getAccessKeys())\n            .filter(({ public_key, access_key: { permission } }) => permission === 'FullAccess' && !seedOrLedgerKey.includes(public_key))\n            .map((ak) => ak.public_key)\n            .map(toPK);\n        const confirmOnlyKey = toPK((await this.postSignedJson('/2fa/getAccessKey', { accountId })).publicKey);\n        const newArgs = Buffer.from(JSON.stringify({ 'num_confirmations': 2 }));\n        const actions = [\n            ...fak2lak.map((pk) => transaction_1.deleteKey(pk)),\n            ...fak2lak.map((pk) => transaction_1.addKey(pk, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CHANGE_METHODS, null))),\n            transaction_1.addKey(confirmOnlyKey, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CONFIRM_METHODS, null)),\n            transaction_1.deployContract(contractBytes),\n        ];\n        if ((await this.state()).code_hash === '11111111111111111111111111111111') {\n            actions.push(transaction_1.functionCall('new', newArgs, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT));\n        }\n        console.log('deploying multisig contract for', accountId);\n        return await super.signAndSendTransactionWithAccount(accountId, actions);\n    }\n    async disable(contractBytes) {\n        const { accountId } = this;\n        const accessKeys = await this.getAccessKeys();\n        const lak2fak = accessKeys\n            .filter(({ access_key }) => access_key.permission !== 'FullAccess')\n            .filter(({ access_key }) => {\n            const perm = access_key.permission.FunctionCall;\n            return perm.receiver_id === accountId &&\n                perm.method_names.length === 4 &&\n                perm.method_names.includes('add_request_and_confirm');\n        });\n        const confirmOnlyKey = key_pair_1.PublicKey.from((await this.postSignedJson('/2fa/getAccessKey', { accountId })).publicKey);\n        const actions = [\n            transaction_1.deleteKey(confirmOnlyKey),\n            ...lak2fak.map(({ public_key }) => transaction_1.deleteKey(key_pair_1.PublicKey.from(public_key))),\n            ...lak2fak.map(({ public_key }) => transaction_1.addKey(key_pair_1.PublicKey.from(public_key), null)),\n            transaction_1.deployContract(contractBytes),\n        ];\n        console.log('disabling 2fa for', accountId);\n        return await this.signAndSendTransaction({\n            receiverId: accountId,\n            actions\n        });\n    }\n    async sendCodeDefault() {\n        const { accountId } = this;\n        const { requestId } = this.getRequest();\n        const method = await this.get2faMethod();\n        await this.postSignedJson('/2fa/send', {\n            accountId,\n            method,\n            requestId,\n        });\n        return requestId;\n    }\n    async getCodeDefault(method) {\n        throw new Error('There is no getCode callback provided. Please provide your own in AccountMultisig constructor options. It has a parameter method where method.kind is \"email\" or \"phone\".');\n    }\n    async promptAndVerify() {\n        const method = await this.get2faMethod();\n        const securityCode = await this.getCode(method);\n        try {\n            const result = await this.verifyCode(securityCode);\n            // TODO: Parse error from result for real (like in normal account.signAndSendTransaction)\n            return result;\n        }\n        catch (e) {\n            console.warn('Error validating security code:', e);\n            if (e.toString().includes('invalid 2fa code provided') || e.toString().includes('2fa code not valid')) {\n                return await this.promptAndVerify();\n            }\n            throw e;\n        }\n    }\n    async verifyCodeDefault(securityCode) {\n        const { accountId } = this;\n        const request = this.getRequest();\n        if (!request) {\n            throw new Error('no request pending');\n        }\n        const { requestId } = request;\n        return await this.postSignedJson('/2fa/verify', {\n            accountId,\n            securityCode,\n            requestId\n        });\n    }\n    async getRecoveryMethods() {\n        const { accountId } = this;\n        return {\n            accountId,\n            data: await this.postSignedJson('/account/recoveryMethods', { accountId })\n        };\n    }\n    async get2faMethod() {\n        let { data } = await this.getRecoveryMethods();\n        if (data && data.length) {\n            data = data.find((m) => m.kind.indexOf('2fa-') === 0);\n        }\n        if (!data)\n            return null;\n        const { kind, detail } = data;\n        return { kind, detail };\n    }\n    async signatureFor() {\n        const { accountId } = this;\n        const block = await this.connection.provider.block({ finality: 'final' });\n        const blockNumber = block.header.height.toString();\n        const signed = await this.connection.signer.signMessage(Buffer.from(blockNumber), accountId, this.connection.networkId);\n        const blockNumberSignature = Buffer.from(signed.signature).toString('base64');\n        return { blockNumber, blockNumberSignature };\n    }\n    async postSignedJson(path, body) {\n        return await web_1.fetchJson(this.helperUrl + path, JSON.stringify({\n            ...body,\n            ...(await this.signatureFor())\n        }));\n    }\n}\nexports.Account2FA = Account2FA;\n// helpers\nconst toPK = (pk) => key_pair_1.PublicKey.from(pk);\nconst convertPKForContract = (pk) => pk.toString().replace('ed25519:', '');\nconst convertActions = (actions, accountId, receiverId) => actions.map((a) => {\n    const type = a.enum;\n    const { gas, publicKey, methodName, args, deposit, accessKey, code } = a[type];\n    const action = {\n        type: type[0].toUpperCase() + type.substr(1),\n        gas: (gas && gas.toString()) || undefined,\n        public_key: (publicKey && convertPKForContract(publicKey)) || undefined,\n        method_name: methodName,\n        args: (args && Buffer.from(args).toString('base64')) || undefined,\n        code: (code && Buffer.from(code).toString('base64')) || undefined,\n        amount: (deposit && deposit.toString()) || undefined,\n        deposit: (deposit && deposit.toString()) || '0',\n        permission: undefined,\n    };\n    if (accessKey) {\n        if (receiverId === accountId && accessKey.permission.enum !== 'fullAccess') {\n            action.permission = {\n                receiver_id: accountId,\n                allowance: exports.MULTISIG_ALLOWANCE.toString(),\n                method_names: exports.MULTISIG_CHANGE_METHODS,\n            };\n        }\n        if (accessKey.permission.enum === 'functionCall') {\n            const { receiverId: receiver_id, methodNames: method_names, allowance } = accessKey.permission.functionCall;\n            action.permission = {\n                receiver_id,\n                allowance: (allowance && allowance.toString()) || undefined,\n                method_names\n            };\n        }\n    }\n    return action;\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}