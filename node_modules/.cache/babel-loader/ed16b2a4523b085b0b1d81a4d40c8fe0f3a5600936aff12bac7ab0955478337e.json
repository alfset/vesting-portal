{"ast":null,"code":"import { EventEmitter } from \"events\";\nimport { IJsonRpcProvider, isJsonRpcResponse, formatJsonRpcRequest, isJsonRpcError, getBigIntRpcId } from \"@walletconnect/jsonrpc-utils\";\nexport class JsonRpcProvider extends IJsonRpcProvider {\n  constructor(connection) {\n    super(connection);\n    this.events = new EventEmitter();\n    this.hasRegisteredEventListeners = false;\n    this.connection = this.setConnection(connection);\n    if (this.connection.connected) {\n      this.registerEventListeners();\n    }\n  }\n  async connect() {\n    let connection = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.connection;\n    await this.open(connection);\n  }\n  async disconnect() {\n    await this.close();\n  }\n  on(event, listener) {\n    this.events.on(event, listener);\n  }\n  once(event, listener) {\n    this.events.once(event, listener);\n  }\n  off(event, listener) {\n    this.events.off(event, listener);\n  }\n  removeListener(event, listener) {\n    this.events.removeListener(event, listener);\n  }\n  async request(request, context) {\n    return this.requestStrict(formatJsonRpcRequest(request.method, request.params || [], request.id || getBigIntRpcId().toString()), context);\n  }\n  async requestStrict(request, context) {\n    return new Promise(async (resolve, reject) => {\n      if (!this.connection.connected) {\n        try {\n          await this.open();\n        } catch (e) {\n          reject(e);\n        }\n      }\n      this.events.on(\"\".concat(request.id), response => {\n        if (isJsonRpcError(response)) {\n          reject(response.error);\n        } else {\n          resolve(response.result);\n        }\n      });\n      try {\n        await this.connection.send(request, context);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n  setConnection() {\n    let connection = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.connection;\n    return connection;\n  }\n  onPayload(payload) {\n    this.events.emit(\"payload\", payload);\n    if (isJsonRpcResponse(payload)) {\n      this.events.emit(\"\".concat(payload.id), payload);\n    } else {\n      this.events.emit(\"message\", {\n        type: payload.method,\n        data: payload.params\n      });\n    }\n  }\n  onClose(event) {\n    if (event && event.code === 3000) {\n      this.events.emit(\"error\", new Error(\"WebSocket connection closed abnormally with code: \".concat(event.code, \" \").concat(event.reason ? \"(\".concat(event.reason, \")\") : \"\")));\n    }\n    this.events.emit(\"disconnect\");\n  }\n  async open() {\n    let connection = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.connection;\n    if (this.connection === connection && this.connection.connected) return;\n    if (this.connection.connected) this.close();\n    if (typeof connection === \"string\") {\n      await this.connection.open(connection);\n      connection = this.connection;\n    }\n    this.connection = this.setConnection(connection);\n    await this.connection.open();\n    this.registerEventListeners();\n    this.events.emit(\"connect\");\n  }\n  async close() {\n    await this.connection.close();\n  }\n  registerEventListeners() {\n    if (this.hasRegisteredEventListeners) return;\n    this.connection.on(\"payload\", payload => this.onPayload(payload));\n    this.connection.on(\"close\", event => this.onClose(event));\n    this.connection.on(\"error\", error => this.events.emit(\"error\", error));\n    this.connection.on(\"register_error\", error => this.onClose());\n    this.hasRegisteredEventListeners = true;\n  }\n}\nexport default JsonRpcProvider;","map":{"version":3,"names":["EventEmitter","IJsonRpcProvider","isJsonRpcResponse","formatJsonRpcRequest","isJsonRpcError","getBigIntRpcId","JsonRpcProvider","constructor","connection","events","hasRegisteredEventListeners","setConnection","connected","registerEventListeners","connect","arguments","length","undefined","open","disconnect","close","on","event","listener","once","off","removeListener","request","context","requestStrict","method","params","id","toString","Promise","resolve","reject","e","concat","response","error","result","send","onPayload","payload","emit","type","data","onClose","code","Error","reason"],"sources":["../../src/provider.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}