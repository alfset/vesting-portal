{"ast":null,"code":"import{useCallback,useEffect}from'react';import{useActiveReact}from'../../hooks/useActiveReact';import useInterval from'../../hooks/useInterval';import{useDispatch}from'react-redux';import{aptBalanceList}from'./actions';import{useLoginAptos,// useAptAllowance,\nuseAptosBalance}from'./index';export default function Updater(){const{chainId,account}=useActiveReact();const dispatch=useDispatch();// const {setAptAllowance} = useAptAllowance()\nconst{loginAptos}=useLoginAptos();const{getAptosResource}=useAptosBalance();const getBalance=useCallback(()=>{getAptosResource(chainId,account).then(res=>{const list={};// console.log(res)\nif(res&&!res.error_code){for(const obj of res){var _obj$data,_obj$data$coin;const type=obj.type;const token=type.replace('0x1::coin::CoinStore<','').replace('>','');if(obj===null||obj===void 0?void 0:(_obj$data=obj.data)===null||_obj$data===void 0?void 0:(_obj$data$coin=_obj$data.coin)===null||_obj$data$coin===void 0?void 0:_obj$data$coin.value){var _obj$data2,_obj$data2$coin;list[token]={balance:obj===null||obj===void 0?void 0:(_obj$data2=obj.data)===null||_obj$data2===void 0?void 0:(_obj$data2$coin=_obj$data2.coin)===null||_obj$data2$coin===void 0?void 0:_obj$data2$coin.value};}}}// console.log(list)\ndispatch(aptBalanceList({list}));});},[account,chainId,dispatch]);useEffect(()=>{// setAptAllowance('0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin',chainId, account)\n// getAptosResource(chainId, '0xc7e368b409404fd9bd27c0f6317996a7d36d94804ff72322586af0fd973126a3', '0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin').then((res:any) => {\n//   console.log(res)\n// })\ngetBalance();},[account,chainId,dispatch]);useInterval(getBalance,1000*5);const getAptosAddress=useCallback(()=>{loginAptos(chainId);},[chainId]);useEffect(()=>{getAptosAddress();},[chainId]);return null;}","map":{"version":3,"names":["useCallback","useEffect","useActiveReact","useInterval","useDispatch","aptBalanceList","useLoginAptos","useAptosBalance","Updater","chainId","account","dispatch","loginAptos","getAptosResource","getBalance","then","res","list","error_code","obj","_obj$data","_obj$data$coin","type","token","replace","data","coin","value","_obj$data2","_obj$data2$coin","balance","getAptosAddress"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/nonevm/apt/updater.ts"],"sourcesContent":["import { useCallback, useEffect } from 'react'\nimport { useActiveReact } from '../../hooks/useActiveReact'\nimport useInterval from '../../hooks/useInterval'\nimport { useDispatch } from 'react-redux'\nimport { AppDispatch } from '../../state'\nimport {aptBalanceList} from './actions'\n\nimport {\n  useLoginAptos,\n  // useAptAllowance,\n  useAptosBalance\n} from './index'\n\nexport default function Updater(): null {\n  const { chainId,account } = useActiveReact()\n  const dispatch = useDispatch<AppDispatch>()\n  // const {setAptAllowance} = useAptAllowance()\n  const {loginAptos} = useLoginAptos()\n  const {getAptosResource} = useAptosBalance()\n\n  const getBalance = useCallback(() => {\n    getAptosResource(chainId, account).then((res:any) => {\n      const list:any = {}\n      // console.log(res)\n      if (res && !res.error_code) {\n        for (const obj of res) {\n          const type = obj.type\n          const token = type.replace('0x1::coin::CoinStore<', '').replace('>', '')\n          if (obj?.data?.coin?.value) {\n            list[token] = {\n              balance: obj?.data?.coin?.value\n            }\n          }\n        }\n      }\n      // console.log(list)\n      dispatch(aptBalanceList({list}))\n    })\n  }, [account, chainId, dispatch])\n\n  useEffect(() => {\n    // setAptAllowance('0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin',chainId, account)\n    // getAptosResource(chainId, '0xc7e368b409404fd9bd27c0f6317996a7d36d94804ff72322586af0fd973126a3', '0x5f31dac7618ccf2df75e0f5c458603d7a3ee2acb48d977ee41da3e562d7a90f6::USDT::Coin').then((res:any) => {\n    //   console.log(res)\n    // })\n    getBalance()\n  }, [account, chainId, dispatch])\n\n  useInterval(getBalance, 1000 * 5)\n\n  const getAptosAddress = useCallback(() => {\n    loginAptos(chainId)\n  }, [chainId])\n\n  useEffect(() => {\n    getAptosAddress()\n  }, [chainId])\n\n  return null\n}"],"mappings":"AAAA,OAASA,WAAW,CAAEC,SAAS,KAAQ,OAAO,CAC9C,OAASC,cAAc,KAAQ,4BAA4B,CAC3D,MAAO,CAAAC,WAAW,KAAM,yBAAyB,CACjD,OAASC,WAAW,KAAQ,aAAa,CAEzC,OAAQC,cAAc,KAAO,WAAW,CAExC,OACEC,aAAa,CACb;AACAC,eAAe,KACV,SAAS,CAEhB,cAAe,SAAS,CAAAC,OAAOA,CAAA,CAAS,CACtC,KAAM,CAAEC,OAAO,CAACC,OAAQ,CAAC,CAAGR,cAAc,CAAC,CAAC,CAC5C,KAAM,CAAAS,QAAQ,CAAGP,WAAW,CAAc,CAAC,CAC3C;AACA,KAAM,CAACQ,UAAU,CAAC,CAAGN,aAAa,CAAC,CAAC,CACpC,KAAM,CAACO,gBAAgB,CAAC,CAAGN,eAAe,CAAC,CAAC,CAE5C,KAAM,CAAAO,UAAU,CAAGd,WAAW,CAAC,IAAM,CACnCa,gBAAgB,CAACJ,OAAO,CAAEC,OAAO,CAAC,CAACK,IAAI,CAAEC,GAAO,EAAK,CACnD,KAAM,CAAAC,IAAQ,CAAG,CAAC,CAAC,CACnB;AACA,GAAID,GAAG,EAAI,CAACA,GAAG,CAACE,UAAU,CAAE,CAC1B,IAAK,KAAM,CAAAC,GAAG,GAAI,CAAAH,GAAG,CAAE,KAAAI,SAAA,CAAAC,cAAA,CACrB,KAAM,CAAAC,IAAI,CAAGH,GAAG,CAACG,IAAI,CACrB,KAAM,CAAAC,KAAK,CAAGD,IAAI,CAACE,OAAO,CAAC,uBAAuB,CAAE,EAAE,CAAC,CAACA,OAAO,CAAC,GAAG,CAAE,EAAE,CAAC,CACxE,GAAIL,GAAG,SAAHA,GAAG,kBAAAC,SAAA,CAAHD,GAAG,CAAEM,IAAI,UAAAL,SAAA,kBAAAC,cAAA,CAATD,SAAA,CAAWM,IAAI,UAAAL,cAAA,iBAAfA,cAAA,CAAiBM,KAAK,CAAE,KAAAC,UAAA,CAAAC,eAAA,CAC1BZ,IAAI,CAACM,KAAK,CAAC,CAAG,CACZO,OAAO,CAAEX,GAAG,SAAHA,GAAG,kBAAAS,UAAA,CAAHT,GAAG,CAAEM,IAAI,UAAAG,UAAA,kBAAAC,eAAA,CAATD,UAAA,CAAWF,IAAI,UAAAG,eAAA,iBAAfA,eAAA,CAAiBF,KAC5B,CAAC,CACH,CACF,CACF,CACA;AACAhB,QAAQ,CAACN,cAAc,CAAC,CAACY,IAAI,CAAC,CAAC,CAAC,CAClC,CAAC,CAAC,CACJ,CAAC,CAAE,CAACP,OAAO,CAAED,OAAO,CAAEE,QAAQ,CAAC,CAAC,CAEhCV,SAAS,CAAC,IAAM,CACd;AACA;AACA;AACA;AACAa,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,CAACJ,OAAO,CAAED,OAAO,CAAEE,QAAQ,CAAC,CAAC,CAEhCR,WAAW,CAACW,UAAU,CAAE,IAAI,CAAG,CAAC,CAAC,CAEjC,KAAM,CAAAiB,eAAe,CAAG/B,WAAW,CAAC,IAAM,CACxCY,UAAU,CAACH,OAAO,CAAC,CACrB,CAAC,CAAE,CAACA,OAAO,CAAC,CAAC,CAEbR,SAAS,CAAC,IAAM,CACd8B,eAAe,CAAC,CAAC,CACnB,CAAC,CAAE,CAACtB,OAAO,CAAC,CAAC,CAEb,MAAO,KAAI,CACb"},"metadata":{},"sourceType":"module","externalDependencies":[]}