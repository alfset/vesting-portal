{"ast":null,"code":"import { useCallback, useEffect, useRef } from \"react\";\nimport { useDispatch\n// useSelector\n} from 'react-redux';\nimport { ChainId } from \"../../config/chainConfig/chainId\";\nimport { useActiveReact } from '../../hooks/useActiveReact';\nimport { adaAddress, adaBalanceList } from './actions';\nimport useInterval from \"../../hooks/useInterval\";\n\n// import { CML, cmlToCore } from \"@cardano-sdk/core\";\n// import {\n//   useAdaBalance\n// } from './index'\n\nexport default function Updater() {\n  const {\n    chainId,\n    account\n  } = useActiveReact();\n  const dispatch = useDispatch();\n  const setAdaAddress = useCallback(address => {\n    dispatch(adaAddress({\n      address\n    }));\n  }, [dispatch]);\n  const eternlRef = useRef();\n  window.onload = () => {\n    var _window, _window$cardano;\n    eternlRef.current = (_window = window) === null || _window === void 0 ? void 0 : (_window$cardano = _window.cardano) === null || _window$cardano === void 0 ? void 0 : _window$cardano.eternl;\n  };\n  const bigIntToString = obj => {\n    return Object.keys(obj).reduce((acc, key) => {\n      acc[key] = obj[key].toString();\n      return acc;\n    }, {});\n  };\n  const getFetchBalance = async () => {\n    var _window2, _window2$lucid;\n    if (window.lucid && ((_window2 = window) === null || _window2 === void 0 ? void 0 : (_window2$lucid = _window2.lucid) === null || _window2$lucid === void 0 ? void 0 : _window2$lucid.wallet)) {\n      let blList = {};\n      try {\n        const utxos = await window.lucid.wallet.getUtxos();\n        console.log(utxos);\n        let total = BigInt(0);\n        utxos.map(e => {\n          setAdaAddress(e.address);\n          total += e.assets.lovelace;\n          for (const tokenAddress in e.assets) {\n            const _tokenAddress = tokenAddress.slice(0, 56) + '.' + tokenAddress.slice(56, tokenAddress.length);\n            if (tokenAddress !== \"lovelace\") {\n              if (blList[_tokenAddress]) {\n                blList[_tokenAddress] = blList[_tokenAddress] + e.assets[tokenAddress];\n              } else {\n                blList[_tokenAddress] = e.assets[tokenAddress]; // BigInt(10000000).toString();\n              }\n            }\n          }\n        });\n\n        blList['NATIVE'] = total.toString();\n        blList = bigIntToString(blList);\n        dispatch(adaBalanceList({\n          list: blList\n        }));\n      } catch (error) {}\n    }\n  };\n  const getBalance = useCallback(() => {\n    var _window3, _window4, _window4$cardano;\n    // if (!account) return;\n    const adaWallet = ((_window3 = window) === null || _window3 === void 0 ? void 0 : _window3.cardano) && ((_window4 = window) === null || _window4 === void 0 ? void 0 : (_window4$cardano = _window4.cardano) === null || _window4$cardano === void 0 ? void 0 : _window4$cardano.eternl);\n    if ([ChainId.ADA, ChainId.ADA_TEST].includes(chainId) && adaWallet) {\n      getFetchBalance();\n    }\n  }, [chainId, eternlRef.current, account]);\n  useEffect(() => {\n    getBalance();\n  }, [chainId, eternlRef.current, account]);\n  useInterval(getBalance, 1000 * 10);\n  useEffect(() => {\n    var _window5, _window6, _window6$cardano;\n    const adaWallet = ((_window5 = window) === null || _window5 === void 0 ? void 0 : _window5.cardano) && ((_window6 = window) === null || _window6 === void 0 ? void 0 : (_window6$cardano = _window6.cardano) === null || _window6$cardano === void 0 ? void 0 : _window6$cardano.eternl);\n    if ([ChainId.ADA, ChainId.ADA_TEST].includes(chainId) && adaWallet) {\n      getBalance();\n      const handleChainChanged = chainID => {\n        console.log(chainID);\n      };\n      const handleAccountsChanged = () => {\n        getBalance();\n      };\n      if (adaWallet === null || adaWallet === void 0 ? void 0 : adaWallet.on) {\n        adaWallet === null || adaWallet === void 0 ? void 0 : adaWallet.on('networkChanged', handleChainChanged);\n        adaWallet === null || adaWallet === void 0 ? void 0 : adaWallet.on('accountChanged', handleAccountsChanged);\n      }\n      return () => {\n        if (adaWallet.removeListener) {\n          adaWallet.removeListener('chainChanged', handleChainChanged);\n          adaWallet.removeListener('accountsChanged', handleAccountsChanged);\n        }\n      };\n    }\n    return undefined;\n  }, [chainId, eternlRef.current]);\n  return null;\n}","map":{"version":3,"names":["useCallback","useEffect","useRef","useDispatch","ChainId","useActiveReact","adaAddress","adaBalanceList","useInterval","Updater","chainId","account","dispatch","setAdaAddress","address","eternlRef","window","onload","_window","_window$cardano","current","cardano","eternl","bigIntToString","obj","Object","keys","reduce","acc","key","toString","getFetchBalance","_window2","_window2$lucid","lucid","wallet","blList","utxos","getUtxos","console","log","total","BigInt","map","e","assets","lovelace","tokenAddress","_tokenAddress","slice","length","list","error","getBalance","_window3","_window4","_window4$cardano","adaWallet","ADA","ADA_TEST","includes","_window5","_window6","_window6$cardano","handleChainChanged","chainID","handleAccountsChanged","on","removeListener","undefined"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/nonevm/cardano/updater.ts"],"sourcesContent":["import { useCallback, useEffect, useRef } from \"react\";\nimport {\n  useDispatch,\n  // useSelector\n} from 'react-redux'\nimport {\n  // AppState,\n  AppDispatch\n} from '../../state'\nimport { ChainId } from \"../../config/chainConfig/chainId\";\n\nimport { useActiveReact } from '../../hooks/useActiveReact'\n\nimport {\n  adaAddress,\n  adaBalanceList\n} from './actions'\nimport useInterval from \"../../hooks/useInterval\";\n\n// import { CML, cmlToCore } from \"@cardano-sdk/core\";\n// import {\n//   useAdaBalance\n// } from './index'\n\nexport default function Updater(): null {\n  const { chainId, account } = useActiveReact()\n  const dispatch = useDispatch<AppDispatch>()\n\n\n  const setAdaAddress = useCallback((address: any) => {\n    dispatch(adaAddress({ address }))\n  }, [dispatch])\n\n\n  const eternlRef = useRef<any>()\n\n  window.onload = () => {\n    eternlRef.current = window?.cardano?.eternl\n  };\n\n  const bigIntToString = (obj: any): any => {\n    return Object.keys(obj).reduce((acc:any, key:any) => {\n      acc[key] = obj[key].toString();\n      return acc;\n    }, {});\n  }\n  \n  const getFetchBalance = async () => {\n    if (window.lucid && window?.lucid?.wallet) {\n      let blList: any = {}\n      try {\n        const utxos = await window.lucid.wallet.getUtxos()\n        console.log(utxos)\n        let total = BigInt(0);\n        utxos.map((e: any) => {\n          setAdaAddress(e.address)\n          total += e.assets.lovelace;\n          for (const tokenAddress in e.assets) {\n            const _tokenAddress = tokenAddress.slice(0,56) + '.' + tokenAddress.slice(56, tokenAddress.length);\n            if(tokenAddress !== \"lovelace\") {\n              if(blList[_tokenAddress]) {\n                blList[_tokenAddress] = blList[_tokenAddress] + e.assets[tokenAddress]\n              } else {\n                blList[_tokenAddress] = e.assets[tokenAddress] // BigInt(10000000).toString();\n              }\n            }\n          }\n        });\n        blList['NATIVE'] = total.toString();\n        blList = bigIntToString(blList);\n        dispatch(adaBalanceList({ list: blList }))\n      } catch (error) {\n        \n      } \n      \n    }\n\n  }\n\n  \n  const getBalance = useCallback(() => {\n    // if (!account) return;\n    const adaWallet = window?.cardano && window?.cardano?.eternl\n\n    if ([ChainId.ADA, ChainId.ADA_TEST].includes(chainId) && adaWallet) {\n      getFetchBalance()\n\n    }\n  }, [chainId, eternlRef.current, account])\n\n  useEffect(() => {\n    getBalance()\n  }, [chainId, eternlRef.current, account])\n\n  useInterval(getBalance, 1000 * 10)\n\n  useEffect(() => {\n    const adaWallet = window?.cardano && window?.cardano?.eternl\n\n    if ([ChainId.ADA, ChainId.ADA_TEST].includes(chainId) && adaWallet) {\n      getBalance()\n\n      const handleChainChanged = (chainID: any) => {\n        console.log(chainID)\n      }\n\n      const handleAccountsChanged = () => {\n        getBalance()\n      }\n\n      if (adaWallet?.on) {\n        adaWallet?.on('networkChanged', handleChainChanged)\n        adaWallet?.on('accountChanged', handleAccountsChanged)\n      }\n\n      return () => {\n        if (adaWallet.removeListener) {\n          adaWallet.removeListener('chainChanged', handleChainChanged)\n          adaWallet.removeListener('accountsChanged', handleAccountsChanged)\n        }\n      }\n    }\n    return undefined\n  }, [chainId, eternlRef.current])\n\n  return null\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}