{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CallBuilder = void 0;\nvar tslib_1 = require(\"tslib\");\nvar detect_node_1 = tslib_1.__importDefault(require(\"detect-node\"));\nvar urijs_1 = tslib_1.__importDefault(require(\"urijs\"));\nvar URITemplate_1 = tslib_1.__importDefault(require(\"urijs/src/URITemplate\"));\nvar errors_1 = require(\"./errors\");\nvar horizon_axios_client_1 = tslib_1.__importDefault(require(\"./horizon_axios_client\"));\nvar version = require(\"../package.json\").version;\nvar JOINABLE = [\"transaction\"];\nvar EventSource;\nvar anyGlobal = global;\nif (anyGlobal.EventSource) {\n  EventSource = anyGlobal.EventSource;\n} else if (detect_node_1.default) {\n  EventSource = require(\"eventsource\");\n} else if (anyGlobal.window.EventSource) {\n  EventSource = anyGlobal.window.EventSource;\n} else {\n  EventSource = require(\"eventsource\");\n}\nvar CallBuilder = function () {\n  function CallBuilder(serverUrl, neighborRoot) {\n    if (neighborRoot === void 0) {\n      neighborRoot = \"\";\n    }\n    this.url = serverUrl.clone();\n    this.filter = [];\n    this.originalSegments = this.url.segment() || [];\n    this.neighborRoot = neighborRoot;\n  }\n  CallBuilder.prototype.call = function () {\n    var _this = this;\n    this.checkFilter();\n    return this._sendNormalRequest(this.url).then(function (r) {\n      return _this._parseResponse(r);\n    });\n  };\n  CallBuilder.prototype.stream = function (options) {\n    var _this = this;\n    if (options === void 0) {\n      options = {};\n    }\n    this.checkFilter();\n    this.url.setQuery(\"X-Client-Name\", \"js-stellar-sdk\");\n    this.url.setQuery(\"X-Client-Version\", version);\n    var es;\n    var timeout;\n    var createTimeout = function () {\n      timeout = setTimeout(function () {\n        if (es) {\n          es.close();\n        }\n        es = createEventSource();\n      }, options.reconnectTimeout || 15 * 1000);\n    };\n    var createEventSource = function () {\n      try {\n        es = new EventSource(_this.url.toString());\n      } catch (err) {\n        if (options.onerror) {\n          options.onerror(err);\n        }\n      }\n      createTimeout();\n      if (es) {\n        var closed_1 = false;\n        var onClose_1 = function () {\n          if (closed_1) {\n            return;\n          }\n          clearTimeout(timeout);\n          es.close();\n          createEventSource();\n          closed_1 = true;\n        };\n        var onMessage = function (message) {\n          if (message.type === \"close\") {\n            onClose_1();\n            return;\n          }\n          var result = message.data ? _this._parseRecord(JSON.parse(message.data)) : message;\n          if (result.paging_token) {\n            _this.url.setQuery(\"cursor\", result.paging_token);\n          }\n          clearTimeout(timeout);\n          createTimeout();\n          if (typeof options.onmessage !== \"undefined\") {\n            options.onmessage(result);\n          }\n        };\n        var onError = function (error) {\n          if (options.onerror) {\n            options.onerror(error);\n          }\n        };\n        if (es.addEventListener) {\n          es.addEventListener(\"message\", onMessage.bind(_this));\n          es.addEventListener(\"error\", onError.bind(_this));\n          es.addEventListener(\"close\", onClose_1.bind(_this));\n        } else {\n          es.onmessage = onMessage.bind(_this);\n          es.onerror = onError.bind(_this);\n        }\n      }\n      return es;\n    };\n    createEventSource();\n    return function close() {\n      clearTimeout(timeout);\n      if (es) {\n        es.close();\n      }\n    };\n  };\n  CallBuilder.prototype.cursor = function (cursor) {\n    this.url.setQuery(\"cursor\", cursor);\n    return this;\n  };\n  CallBuilder.prototype.limit = function (recordsNumber) {\n    this.url.setQuery(\"limit\", recordsNumber.toString());\n    return this;\n  };\n  CallBuilder.prototype.order = function (direction) {\n    this.url.setQuery(\"order\", direction);\n    return this;\n  };\n  CallBuilder.prototype.join = function (include) {\n    this.url.setQuery(\"join\", include);\n    return this;\n  };\n  CallBuilder.prototype.forEndpoint = function (endpoint, param) {\n    if (this.neighborRoot === \"\") {\n      throw new Error(\"Invalid usage: neighborRoot not set in constructor\");\n    }\n    this.filter.push([endpoint, param, this.neighborRoot]);\n    return this;\n  };\n  CallBuilder.prototype.checkFilter = function () {\n    if (this.filter.length >= 2) {\n      throw new errors_1.BadRequestError(\"Too many filters specified\", this.filter);\n    }\n    if (this.filter.length === 1) {\n      var newSegment = this.originalSegments.concat(this.filter[0]);\n      this.url.segment(newSegment);\n    }\n  };\n  CallBuilder.prototype._requestFnForLink = function (link) {\n    var _this = this;\n    return function (opts) {\n      if (opts === void 0) {\n        opts = {};\n      }\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var uri, template, r;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (link.templated) {\n                template = URITemplate_1.default(link.href);\n                uri = urijs_1.default(template.expand(opts));\n              } else {\n                uri = urijs_1.default(link.href);\n              }\n              return [4, this._sendNormalRequest(uri)];\n            case 1:\n              r = _a.sent();\n              return [2, this._parseResponse(r)];\n          }\n        });\n      });\n    };\n  };\n  CallBuilder.prototype._parseRecord = function (json) {\n    var _this = this;\n    if (!json._links) {\n      return json;\n    }\n    var _loop_1 = function (key) {\n      var n = json._links[key];\n      var included = false;\n      if (typeof json[key] !== \"undefined\") {\n        json[key + \"_attr\"] = json[key];\n        included = true;\n      }\n      if (included && JOINABLE.indexOf(key) >= 0) {\n        var record_1 = this_1._parseRecord(json[key]);\n        json[key] = function () {\n          return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n              return [2, record_1];\n            });\n          });\n        };\n      } else {\n        json[key] = this_1._requestFnForLink(n);\n      }\n    };\n    var this_1 = this;\n    for (var _i = 0, _a = Object.keys(json._links); _i < _a.length; _i++) {\n      var key = _a[_i];\n      _loop_1(key);\n    }\n    return json;\n  };\n  CallBuilder.prototype._sendNormalRequest = function (initialUrl) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var url;\n      return tslib_1.__generator(this, function (_a) {\n        url = initialUrl;\n        if (url.authority() === \"\") {\n          url = url.authority(this.url.authority());\n        }\n        if (url.protocol() === \"\") {\n          url = url.protocol(this.url.protocol());\n        }\n        return [2, horizon_axios_client_1.default.get(url.toString()).then(function (response) {\n          return response.data;\n        }).catch(this._handleNetworkError)];\n      });\n    });\n  };\n  CallBuilder.prototype._parseResponse = function (json) {\n    if (json._embedded && json._embedded.records) {\n      return this._toCollectionPage(json);\n    }\n    return this._parseRecord(json);\n  };\n  CallBuilder.prototype._toCollectionPage = function (json) {\n    var _this = this;\n    for (var i = 0; i < json._embedded.records.length; i += 1) {\n      json._embedded.records[i] = this._parseRecord(json._embedded.records[i]);\n    }\n    return {\n      records: json._embedded.records,\n      next: function () {\n        return tslib_1.__awaiter(_this, void 0, void 0, function () {\n          var r;\n          return tslib_1.__generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4, this._sendNormalRequest(urijs_1.default(json._links.next.href))];\n              case 1:\n                r = _a.sent();\n                return [2, this._toCollectionPage(r)];\n            }\n          });\n        });\n      },\n      prev: function () {\n        return tslib_1.__awaiter(_this, void 0, void 0, function () {\n          var r;\n          return tslib_1.__generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4, this._sendNormalRequest(urijs_1.default(json._links.prev.href))];\n              case 1:\n                r = _a.sent();\n                return [2, this._toCollectionPage(r)];\n            }\n          });\n        });\n      }\n    };\n  };\n  CallBuilder.prototype._handleNetworkError = function (error) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        if (error.response && error.response.status && error.response.statusText) {\n          switch (error.response.status) {\n            case 404:\n              return [2, Promise.reject(new errors_1.NotFoundError(error.response.statusText, error.response.data))];\n            default:\n              return [2, Promise.reject(new errors_1.NetworkError(error.response.statusText, error.response.data))];\n          }\n        } else {\n          return [2, Promise.reject(new Error(error.message))];\n        }\n        return [2];\n      });\n    });\n  };\n  return CallBuilder;\n}();\nexports.CallBuilder = CallBuilder;","map":{"version":3,"names":["detect_node_1","tslib_1","__importDefault","require","urijs_1","URITemplate_1","errors_1","horizon_axios_client_1","version","JOINABLE","EventSource","anyGlobal","global","default","window","CallBuilder","serverUrl","neighborRoot","url","clone","filter","originalSegments","segment","prototype","call","_this","checkFilter","_sendNormalRequest","then","r","_parseResponse","stream","options","setQuery","es","timeout","createTimeout","setTimeout","close","createEventSource","reconnectTimeout","toString","err","onerror","closed_1","onClose_1","clearTimeout","onMessage","message","type","result","data","_parseRecord","JSON","parse","paging_token","onmessage","onError","error","addEventListener","bind","cursor","limit","recordsNumber","order","direction","join","include","forEndpoint","endpoint","param","Error","push","length","BadRequestError","newSegment","concat","_requestFnForLink","link","opts","templated","template","href","uri","expand","_a","sent","json","_links","key","n","included","indexOf","record_1","this_1","__awaiter","__generator","_i","Object","keys","initialUrl","authority","protocol","get","response","catch","_handleNetworkError","_embedded","records","_toCollectionPage","i","next","prev","status","statusText","Promise","reject","NotFoundError","NetworkError","exports"],"sources":["../src/call_builder.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}