{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SignatureV2 = exports.SignMode = void 0;\nvar PublicKey_1 = require(\"./PublicKey\");\nvar Tx_1 = require(\"./Tx\");\nvar CompactBitArray_1 = require(\"./CompactBitArray\");\nvar signing_1 = require(\"@terra-money/terra.proto/cosmos/tx/signing/v1beta1/signing\");\nvar multisig_1 = require(\"@terra-money/terra.proto/cosmos/crypto/multisig/v1beta1/multisig\");\nvar signing_2 = require(\"@terra-money/terra.proto/cosmos/tx/signing/v1beta1/signing\");\nObject.defineProperty(exports, \"SignMode\", {\n  enumerable: true,\n  get: function () {\n    return signing_2.SignMode;\n  }\n});\nvar SignatureV2 = /** @class */function () {\n  function SignatureV2(public_key, data, sequence) {\n    this.public_key = public_key;\n    this.data = data;\n    this.sequence = sequence;\n  }\n  SignatureV2.fromData = function (data) {\n    return new SignatureV2(PublicKey_1.PublicKey.fromData(data.public_key), SignatureV2.Descriptor.fromData(data.data), Number.parseInt(data.sequence));\n  };\n  SignatureV2.prototype.toData = function () {\n    return {\n      public_key: this.public_key.toData(),\n      data: this.data.toData(),\n      sequence: this.sequence.toFixed()\n    };\n  };\n  SignatureV2.fromAmino = function (data) {\n    return new SignatureV2(PublicKey_1.PublicKey.fromAmino(data.pub_key), new SignatureV2.Descriptor(new SignatureV2.Descriptor.Single(SignatureV2.SignMode.SIGN_MODE_LEGACY_AMINO_JSON, data.signature)), 0);\n  };\n  return SignatureV2;\n}();\nexports.SignatureV2 = SignatureV2;\n(function (SignatureV2) {\n  SignatureV2.SignMode = signing_1.SignMode;\n  var Descriptor = /** @class */function () {\n    function Descriptor(data) {\n      data instanceof Descriptor.Single ? this.single = data : this.multi = data;\n    }\n    Descriptor.fromData = function (data) {\n      if (data.single) {\n        return new Descriptor(Descriptor.Single.fromData(data.single));\n      }\n      if (data.multi) {\n        return new Descriptor(Descriptor.Multi.fromData(data.multi));\n      }\n      throw new Error('must be one of single or multi');\n    };\n    Descriptor.prototype.toData = function () {\n      if (this.single) {\n        return {\n          single: this.single.toData()\n        };\n      }\n      if (this.multi) {\n        return {\n          multi: this.multi.toData()\n        };\n      }\n      throw new Error('must be one of single or multi');\n    };\n    Descriptor.prototype.toModeInfoAndSignature = function () {\n      if (this.single) {\n        var sigData = this.single;\n        return [new Tx_1.ModeInfo(new Tx_1.ModeInfo.Single(sigData.mode)), Buffer.from(sigData.signature, 'base64')];\n      }\n      if (this.multi) {\n        var sigData = this.multi;\n        var modeInfos = [];\n        var signatures = [];\n        for (var _i = 0, _a = sigData.signatures; _i < _a.length; _i++) {\n          var signature = _a[_i];\n          var _b = signature.toModeInfoAndSignature(),\n            modeInfo = _b[0],\n            sigBytes = _b[1];\n          modeInfos.push(modeInfo);\n          signatures.push(sigBytes);\n        }\n        var multisigBytes = multisig_1.MultiSignature.encode(multisig_1.MultiSignature.fromPartial({\n          signatures: signatures\n        })).finish();\n        return [new Tx_1.ModeInfo(new Tx_1.ModeInfo.Multi(sigData.bitarray, modeInfos)), multisigBytes];\n      }\n      throw new Error('invalid signature descriptor');\n    };\n    return Descriptor;\n  }();\n  SignatureV2.Descriptor = Descriptor;\n  (function (Descriptor) {\n    var Single = /** @class */function () {\n      function Single(mode, signature) {\n        this.mode = mode;\n        this.signature = signature;\n      }\n      Single.fromData = function (data) {\n        return new Single((0, signing_1.signModeFromJSON)(data.mode), data.signature);\n      };\n      Single.prototype.toData = function () {\n        var _a = this,\n          mode = _a.mode,\n          signature = _a.signature;\n        return {\n          mode: (0, signing_1.signModeToJSON)(mode),\n          signature: signature\n        };\n      };\n      return Single;\n    }();\n    Descriptor.Single = Single;\n    var Multi = /** @class */function () {\n      function Multi(bitarray, signatures) {\n        this.bitarray = bitarray;\n        this.signatures = signatures;\n      }\n      Multi.fromData = function (data) {\n        return new Multi(CompactBitArray_1.CompactBitArray.fromData(data.bitarray), data.signatures.map(function (v) {\n          return Descriptor.fromData(v);\n        }));\n      };\n      Multi.prototype.toData = function () {\n        return {\n          bitarray: this.bitarray.toData(),\n          signatures: this.signatures.map(function (sig) {\n            return sig.toData();\n          })\n        };\n      };\n      return Multi;\n    }();\n    Descriptor.Multi = Multi;\n  })(Descriptor = SignatureV2.Descriptor || (SignatureV2.Descriptor = {}));\n})(SignatureV2 = exports.SignatureV2 || (exports.SignatureV2 = {}));\nexports.SignatureV2 = SignatureV2;","map":{"version":3,"names":["PublicKey_1","require","Tx_1","CompactBitArray_1","signing_1","multisig_1","signing_2","Object","defineProperty","exports","enumerable","get","SignMode","SignatureV2","public_key","data","sequence","fromData","PublicKey","Descriptor","Number","parseInt","prototype","toData","toFixed","fromAmino","pub_key","Single","SIGN_MODE_LEGACY_AMINO_JSON","signature","single","multi","Multi","Error","toModeInfoAndSignature","sigData","ModeInfo","mode","Buffer","from","modeInfos","signatures","_i","_a","length","_b","modeInfo","sigBytes","push","multisigBytes","MultiSignature","encode","fromPartial","finish","bitarray","signModeFromJSON","signModeToJSON","CompactBitArray","map","v","sig"],"sources":["../../src/core/SignatureV2.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}