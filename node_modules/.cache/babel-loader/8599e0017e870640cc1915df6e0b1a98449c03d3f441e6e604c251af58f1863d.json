{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Server = exports.SUBMIT_TRANSACTION_TIMEOUT = void 0;\nvar tslib_1 = require(\"tslib\");\nvar bignumber_js_1 = tslib_1.__importDefault(require(\"bignumber.js\"));\nvar isEmpty_1 = tslib_1.__importDefault(require(\"lodash/isEmpty\"));\nvar merge_1 = tslib_1.__importDefault(require(\"lodash/merge\"));\nvar stellar_base_1 = require(\"stellar-base\");\nvar urijs_1 = tslib_1.__importDefault(require(\"urijs\"));\nvar call_builder_1 = require(\"./call_builder\");\nvar config_1 = require(\"./config\");\nvar errors_1 = require(\"./errors\");\nvar account_call_builder_1 = require(\"./account_call_builder\");\nvar account_response_1 = require(\"./account_response\");\nvar assets_call_builder_1 = require(\"./assets_call_builder\");\nvar claimable_balances_call_builder_1 = require(\"./claimable_balances_call_builder\");\nvar effect_call_builder_1 = require(\"./effect_call_builder\");\nvar friendbot_builder_1 = require(\"./friendbot_builder\");\nvar ledger_call_builder_1 = require(\"./ledger_call_builder\");\nvar liquidity_pool_call_builder_1 = require(\"./liquidity_pool_call_builder\");\nvar offer_call_builder_1 = require(\"./offer_call_builder\");\nvar operation_call_builder_1 = require(\"./operation_call_builder\");\nvar orderbook_call_builder_1 = require(\"./orderbook_call_builder\");\nvar payment_call_builder_1 = require(\"./payment_call_builder\");\nvar strict_receive_path_call_builder_1 = require(\"./strict_receive_path_call_builder\");\nvar strict_send_path_call_builder_1 = require(\"./strict_send_path_call_builder\");\nvar trade_aggregation_call_builder_1 = require(\"./trade_aggregation_call_builder\");\nvar trades_call_builder_1 = require(\"./trades_call_builder\");\nvar transaction_call_builder_1 = require(\"./transaction_call_builder\");\nvar horizon_axios_client_1 = tslib_1.__importStar(require(\"./horizon_axios_client\"));\nexports.SUBMIT_TRANSACTION_TIMEOUT = 60 * 1000;\nvar STROOPS_IN_LUMEN = 10000000;\nvar ACCOUNT_REQUIRES_MEMO = \"MQ==\";\nfunction _getAmountInLumens(amt) {\n  return new bignumber_js_1.default(amt).div(STROOPS_IN_LUMEN).toString();\n}\nvar Server = function () {\n  function Server(serverURL, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    this.serverURL = urijs_1.default(serverURL);\n    var allowHttp = typeof opts.allowHttp === \"undefined\" ? config_1.Config.isAllowHttp() : opts.allowHttp;\n    var customHeaders = {};\n    if (opts.appName) {\n      customHeaders[\"X-App-Name\"] = opts.appName;\n    }\n    if (opts.appVersion) {\n      customHeaders[\"X-App-Version\"] = opts.appVersion;\n    }\n    if (opts.authToken) {\n      customHeaders[\"X-Auth-Token\"] = opts.authToken;\n    }\n    if (!isEmpty_1.default(customHeaders)) {\n      horizon_axios_client_1.default.interceptors.request.use(function (config) {\n        config.headers = merge_1.default(customHeaders, config.headers);\n        return config;\n      });\n    }\n    if (this.serverURL.protocol() !== \"https\" && !allowHttp) {\n      throw new Error(\"Cannot connect to insecure horizon server\");\n    }\n  }\n  Server.prototype.fetchTimebounds = function (seconds, _isRetry) {\n    if (_isRetry === void 0) {\n      _isRetry = false;\n    }\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var currentTime;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            currentTime = horizon_axios_client_1.getCurrentServerTime(this.serverURL.hostname());\n            if (currentTime) {\n              return [2, {\n                minTime: 0,\n                maxTime: currentTime + seconds\n              }];\n            }\n            if (_isRetry) {\n              return [2, {\n                minTime: 0,\n                maxTime: Math.floor(new Date().getTime() / 1000) + seconds\n              }];\n            }\n            return [4, horizon_axios_client_1.default.get(urijs_1.default(this.serverURL).toString())];\n          case 1:\n            _a.sent();\n            return [4, this.fetchTimebounds(seconds, true)];\n          case 2:\n            return [2, _a.sent()];\n        }\n      });\n    });\n  };\n  Server.prototype.fetchBaseFee = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var response;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.feeStats()];\n          case 1:\n            response = _a.sent();\n            return [2, parseInt(response.last_ledger_base_fee, 10) || 100];\n        }\n      });\n    });\n  };\n  Server.prototype.feeStats = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var cb;\n      return tslib_1.__generator(this, function (_a) {\n        cb = new call_builder_1.CallBuilder(urijs_1.default(this.serverURL));\n        cb.filter.push([\"fee_stats\"]);\n        return [2, cb.call()];\n      });\n    });\n  };\n  Server.prototype.submitTransaction = function (transaction, opts) {\n    if (opts === void 0) {\n      opts = {\n        skipMemoRequiredCheck: false\n      };\n    }\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var tx;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!opts.skipMemoRequiredCheck) return [3, 2];\n            return [4, this.checkMemoRequired(transaction)];\n          case 1:\n            _a.sent();\n            _a.label = 2;\n          case 2:\n            tx = encodeURIComponent(transaction.toEnvelope().toXDR().toString(\"base64\"));\n            return [2, horizon_axios_client_1.default.post(urijs_1.default(this.serverURL).segment(\"transactions\").toString(), \"tx=\" + tx, {\n              timeout: exports.SUBMIT_TRANSACTION_TIMEOUT\n            }).then(function (response) {\n              if (!response.data.result_xdr) {\n                return response.data;\n              }\n              var responseXDR = stellar_base_1.xdr.TransactionResult.fromXDR(response.data.result_xdr, \"base64\");\n              var results = responseXDR.result().value();\n              var offerResults;\n              var hasManageOffer;\n              if (results.length) {\n                offerResults = results.map(function (result, i) {\n                  if (result.value().switch().name !== \"manageBuyOffer\" && result.value().switch().name !== \"manageSellOffer\") {\n                    return null;\n                  }\n                  hasManageOffer = true;\n                  var amountBought = new bignumber_js_1.default(0);\n                  var amountSold = new bignumber_js_1.default(0);\n                  var offerSuccess = result.value().value().success();\n                  var offersClaimed = offerSuccess.offersClaimed().map(function (offerClaimedAtom) {\n                    var offerClaimed = offerClaimedAtom.value();\n                    var sellerId = \"\";\n                    switch (offerClaimedAtom.switch()) {\n                      case stellar_base_1.xdr.ClaimAtomType.claimAtomTypeV0():\n                        sellerId = stellar_base_1.StrKey.encodeEd25519PublicKey(offerClaimed.sellerEd25519());\n                        break;\n                      case stellar_base_1.xdr.ClaimAtomType.claimAtomTypeOrderBook():\n                        sellerId = stellar_base_1.StrKey.encodeEd25519PublicKey(offerClaimed.sellerId().ed25519());\n                        break;\n                      default:\n                        throw new Error(\"Invalid offer result type: \" + offerClaimedAtom.switch());\n                    }\n                    var claimedOfferAmountBought = new bignumber_js_1.default(offerClaimed.amountBought().toString());\n                    var claimedOfferAmountSold = new bignumber_js_1.default(offerClaimed.amountSold().toString());\n                    amountBought = amountBought.add(claimedOfferAmountSold);\n                    amountSold = amountSold.add(claimedOfferAmountBought);\n                    var sold = stellar_base_1.Asset.fromOperation(offerClaimed.assetSold());\n                    var bought = stellar_base_1.Asset.fromOperation(offerClaimed.assetBought());\n                    var assetSold = {\n                      type: sold.getAssetType(),\n                      assetCode: sold.getCode(),\n                      issuer: sold.getIssuer()\n                    };\n                    var assetBought = {\n                      type: bought.getAssetType(),\n                      assetCode: bought.getCode(),\n                      issuer: bought.getIssuer()\n                    };\n                    return {\n                      sellerId: sellerId,\n                      offerId: offerClaimed.offerId().toString(),\n                      assetSold: assetSold,\n                      amountSold: _getAmountInLumens(claimedOfferAmountSold),\n                      assetBought: assetBought,\n                      amountBought: _getAmountInLumens(claimedOfferAmountBought)\n                    };\n                  });\n                  var effect = offerSuccess.offer().switch().name;\n                  var currentOffer;\n                  if (typeof offerSuccess.offer().value === \"function\" && offerSuccess.offer().value()) {\n                    var offerXDR = offerSuccess.offer().value();\n                    currentOffer = {\n                      offerId: offerXDR.offerId().toString(),\n                      selling: {},\n                      buying: {},\n                      amount: _getAmountInLumens(offerXDR.amount().toString()),\n                      price: {\n                        n: offerXDR.price().n(),\n                        d: offerXDR.price().d()\n                      }\n                    };\n                    var selling = stellar_base_1.Asset.fromOperation(offerXDR.selling());\n                    currentOffer.selling = {\n                      type: selling.getAssetType(),\n                      assetCode: selling.getCode(),\n                      issuer: selling.getIssuer()\n                    };\n                    var buying = stellar_base_1.Asset.fromOperation(offerXDR.buying());\n                    currentOffer.buying = {\n                      type: buying.getAssetType(),\n                      assetCode: buying.getCode(),\n                      issuer: buying.getIssuer()\n                    };\n                  }\n                  return {\n                    offersClaimed: offersClaimed,\n                    effect: effect,\n                    operationIndex: i,\n                    currentOffer: currentOffer,\n                    amountBought: _getAmountInLumens(amountBought),\n                    amountSold: _getAmountInLumens(amountSold),\n                    isFullyOpen: !offersClaimed.length && effect !== \"manageOfferDeleted\",\n                    wasPartiallyFilled: !!offersClaimed.length && effect !== \"manageOfferDeleted\",\n                    wasImmediatelyFilled: !!offersClaimed.length && effect === \"manageOfferDeleted\",\n                    wasImmediatelyDeleted: !offersClaimed.length && effect === \"manageOfferDeleted\"\n                  };\n                }).filter(function (result) {\n                  return !!result;\n                });\n              }\n              return Object.assign({}, response.data, {\n                offerResults: hasManageOffer ? offerResults : undefined\n              });\n            }).catch(function (response) {\n              if (response instanceof Error) {\n                return Promise.reject(response);\n              }\n              return Promise.reject(new errors_1.BadResponseError(\"Transaction submission failed. Server responded: \" + response.status + \" \" + response.statusText, response.data));\n            })];\n        }\n      });\n    });\n  };\n  Server.prototype.accounts = function () {\n    return new account_call_builder_1.AccountCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.claimableBalances = function () {\n    return new claimable_balances_call_builder_1.ClaimableBalanceCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.ledgers = function () {\n    return new ledger_call_builder_1.LedgerCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.transactions = function () {\n    return new transaction_call_builder_1.TransactionCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.offers = function () {\n    return new offer_call_builder_1.OfferCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.orderbook = function (selling, buying) {\n    return new orderbook_call_builder_1.OrderbookCallBuilder(urijs_1.default(this.serverURL), selling, buying);\n  };\n  Server.prototype.trades = function () {\n    return new trades_call_builder_1.TradesCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.operations = function () {\n    return new operation_call_builder_1.OperationCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.liquidityPools = function () {\n    return new liquidity_pool_call_builder_1.LiquidityPoolCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.strictReceivePaths = function (source, destinationAsset, destinationAmount) {\n    return new strict_receive_path_call_builder_1.StrictReceivePathCallBuilder(urijs_1.default(this.serverURL), source, destinationAsset, destinationAmount);\n  };\n  Server.prototype.strictSendPaths = function (sourceAsset, sourceAmount, destination) {\n    return new strict_send_path_call_builder_1.StrictSendPathCallBuilder(urijs_1.default(this.serverURL), sourceAsset, sourceAmount, destination);\n  };\n  Server.prototype.payments = function () {\n    return new payment_call_builder_1.PaymentCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.effects = function () {\n    return new effect_call_builder_1.EffectCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.friendbot = function (address) {\n    return new friendbot_builder_1.FriendbotBuilder(urijs_1.default(this.serverURL), address);\n  };\n  Server.prototype.assets = function () {\n    return new assets_call_builder_1.AssetsCallBuilder(urijs_1.default(this.serverURL));\n  };\n  Server.prototype.loadAccount = function (accountId) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var res;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.accounts().accountId(accountId).call()];\n          case 1:\n            res = _a.sent();\n            return [2, new account_response_1.AccountResponse(res)];\n        }\n      });\n    });\n  };\n  Server.prototype.tradeAggregation = function (base, counter, start_time, end_time, resolution, offset) {\n    return new trade_aggregation_call_builder_1.TradeAggregationCallBuilder(urijs_1.default(this.serverURL), base, counter, start_time, end_time, resolution, offset);\n  };\n  Server.prototype.checkMemoRequired = function (transaction) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var destinations, i, operation, destination, account, e_1;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (transaction instanceof stellar_base_1.FeeBumpTransaction) {\n              transaction = transaction.innerTransaction;\n            }\n            if (transaction.memo.type !== \"none\") {\n              return [2];\n            }\n            destinations = new Set();\n            i = 0;\n            _a.label = 1;\n          case 1:\n            if (!(i < transaction.operations.length)) return [3, 6];\n            operation = transaction.operations[i];\n            switch (operation.type) {\n              case \"payment\":\n              case \"pathPaymentStrictReceive\":\n              case \"pathPaymentStrictSend\":\n              case \"accountMerge\":\n                break;\n              default:\n                return [3, 5];\n            }\n            destination = operation.destination;\n            if (destinations.has(destination)) {\n              return [3, 5];\n            }\n            destinations.add(destination);\n            if (destination.startsWith(\"M\")) {\n              return [3, 5];\n            }\n            _a.label = 2;\n          case 2:\n            _a.trys.push([2, 4,, 5]);\n            return [4, this.loadAccount(destination)];\n          case 3:\n            account = _a.sent();\n            if (account.data_attr[\"config.memo_required\"] === ACCOUNT_REQUIRES_MEMO) {\n              throw new errors_1.AccountRequiresMemoError(\"account requires memo\", destination, i);\n            }\n            return [3, 5];\n          case 4:\n            e_1 = _a.sent();\n            if (e_1 instanceof errors_1.AccountRequiresMemoError) {\n              throw e_1;\n            }\n            if (!(e_1 instanceof errors_1.NotFoundError)) {\n              throw e_1;\n            }\n            return [3, 5];\n          case 5:\n            i++;\n            return [3, 1];\n          case 6:\n            return [2];\n        }\n      });\n    });\n  };\n  return Server;\n}();\nexports.Server = Server;","map":{"version":3,"names":["bignumber_js_1","tslib_1","__importDefault","require","isEmpty_1","merge_1","stellar_base_1","urijs_1","call_builder_1","config_1","errors_1","account_call_builder_1","account_response_1","assets_call_builder_1","claimable_balances_call_builder_1","effect_call_builder_1","friendbot_builder_1","ledger_call_builder_1","liquidity_pool_call_builder_1","offer_call_builder_1","operation_call_builder_1","orderbook_call_builder_1","payment_call_builder_1","strict_receive_path_call_builder_1","strict_send_path_call_builder_1","trade_aggregation_call_builder_1","trades_call_builder_1","transaction_call_builder_1","horizon_axios_client_1","__importStar","exports","SUBMIT_TRANSACTION_TIMEOUT","STROOPS_IN_LUMEN","ACCOUNT_REQUIRES_MEMO","_getAmountInLumens","amt","default","div","toString","Server","serverURL","opts","allowHttp","Config","isAllowHttp","customHeaders","appName","appVersion","authToken","interceptors","request","use","config","headers","protocol","Error","prototype","fetchTimebounds","seconds","_isRetry","currentTime","getCurrentServerTime","hostname","minTime","maxTime","Math","floor","Date","getTime","get","_a","sent","fetchBaseFee","feeStats","response","parseInt","last_ledger_base_fee","cb","CallBuilder","filter","push","call","submitTransaction","transaction","skipMemoRequiredCheck","checkMemoRequired","tx","encodeURIComponent","toEnvelope","toXDR","post","segment","timeout","then","data","result_xdr","responseXDR","xdr","TransactionResult","fromXDR","results","result","value","offerResults","hasManageOffer","length","map","i","switch","name","amountBought","amountSold","offerSuccess","success","offersClaimed","offerClaimedAtom","offerClaimed","sellerId","ClaimAtomType","claimAtomTypeV0","StrKey","encodeEd25519PublicKey","sellerEd25519","claimAtomTypeOrderBook","ed25519","claimedOfferAmountBought","claimedOfferAmountSold","add","sold","Asset","fromOperation","assetSold","bought","assetBought","type","getAssetType","assetCode","getCode","issuer","getIssuer","offerId","effect","offer","currentOffer","offerXDR","selling","buying","amount","price","n","d","operationIndex","isFullyOpen","wasPartiallyFilled","wasImmediatelyFilled","wasImmediatelyDeleted","Object","assign","undefined","catch","Promise","reject","BadResponseError","status","statusText","accounts","AccountCallBuilder","claimableBalances","ClaimableBalanceCallBuilder","ledgers","LedgerCallBuilder","transactions","TransactionCallBuilder","offers","OfferCallBuilder","orderbook","OrderbookCallBuilder","trades","TradesCallBuilder","operations","OperationCallBuilder","liquidityPools","LiquidityPoolCallBuilder","strictReceivePaths","source","destinationAsset","destinationAmount","StrictReceivePathCallBuilder","strictSendPaths","sourceAsset","sourceAmount","destination","StrictSendPathCallBuilder","payments","PaymentCallBuilder","effects","EffectCallBuilder","friendbot","address","FriendbotBuilder","assets","AssetsCallBuilder","loadAccount","accountId","res","AccountResponse","tradeAggregation","base","counter","start_time","end_time","resolution","offset","TradeAggregationCallBuilder","FeeBumpTransaction","innerTransaction","memo","destinations","Set","operation","has","startsWith","account","data_attr","AccountRequiresMemoError","e_1","NotFoundError"],"sources":["../src/server.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}