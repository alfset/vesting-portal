{"ast":null,"code":"import{AbstractConnector}from'@web3-react/abstract-connector';import SafeAppsSDK from'@gnosis.pm/safe-apps-sdk';import{SafeAppProvider}from'@gnosis.pm/safe-apps-provider';class SafeAppConnector extends AbstractConnector{constructor(opts){super();this.sdk=void 0;this.safe=void 0;this.provider=void 0;this.sdk=new SafeAppsSDK(opts);}async activate(){const runningAsSafeApp=await this.isSafeApp();if(!runningAsSafeApp){throw new Error('The app is loaded outside safe context');}return{provider:await this.getProvider(),chainId:await this.getChainId(),account:await this.getAccount()};}async getSafeInfo(){if(!this.safe){this.safe=await this.sdk.safe.getInfo();}return this.safe;}async getProvider(){if(!this.provider){const safe=await this.getSafeInfo();this.provider=new SafeAppProvider(safe,this.sdk);}return this.provider;}async getChainId(){const provider=await this.getProvider();return provider.chainId;}async getAccount(){const safe=await this.getSafeInfo();return safe.safeAddress;}deactivate(){return;}async isSafeApp(){var _window;// check if we're in an iframe\nif(((_window=window)===null||_window===void 0?void 0:_window.parent)===window){return false;}const safe=await Promise.race([this.getSafeInfo(),new Promise(resolve=>setTimeout(resolve,300))]);return!!safe;}}export{SafeAppConnector};","map":{"version":3,"names":["AbstractConnector","SafeAppsSDK","SafeAppProvider","SafeAppConnector","constructor","opts","sdk","safe","provider","activate","runningAsSafeApp","isSafeApp","Error","getProvider","chainId","getChainId","account","getAccount","getSafeInfo","getInfo","safeAddress","deactivate","_window","window","parent","Promise","race","resolve","setTimeout"],"sources":["/workspace/Planq-Dapps/vesting-portal/src/connectors/gnosis-safe/index.ts"],"sourcesContent":["import { AbstractConnector } from '@web3-react/abstract-connector';\nimport { ConnectorUpdate } from '@web3-react/types';\nimport SafeAppsSDK, { Opts, SafeInfo } from '@gnosis.pm/safe-apps-sdk';\nimport { SafeAppProvider } from '@gnosis.pm/safe-apps-provider';\n\nclass SafeAppConnector extends AbstractConnector {\n  private readonly sdk: SafeAppsSDK;\n  private safe: SafeInfo | undefined;\n  private provider: SafeAppProvider | undefined;\n\n  constructor(opts?: Opts) {\n    super();\n    this.sdk = new SafeAppsSDK(opts);\n  }\n\n  async activate(): Promise<ConnectorUpdate> {\n    const runningAsSafeApp = await this.isSafeApp();\n    if (!runningAsSafeApp) {\n      throw new Error('The app is loaded outside safe context');\n    }\n\n    return { provider: await this.getProvider(), chainId: await this.getChainId(), account: await this.getAccount() };\n  }\n\n  public async getSafeInfo(): Promise<SafeInfo> {\n    if (!this.safe) {\n      this.safe = await this.sdk.safe.getInfo();\n    }\n    return this.safe;\n  }\n\n  public async getProvider(): Promise<SafeAppProvider> {\n    if (!this.provider) {\n      const safe = await this.getSafeInfo();\n      this.provider = new SafeAppProvider(safe, this.sdk);\n    }\n    return this.provider;\n  }\n\n  public async getChainId(): Promise<number> {\n    const provider = await this.getProvider();\n    return provider.chainId;\n  }\n\n  public async getAccount(): Promise<string> {\n    const safe = await this.getSafeInfo();\n    return safe.safeAddress;\n  }\n\n  public deactivate(): void {\n    return;\n  }\n\n  public async isSafeApp(): Promise<boolean> {\n    // check if we're in an iframe\n    if (window?.parent === window) {\n      return false;\n    }\n\n    const safe = await Promise.race([\n      this.getSafeInfo(),\n      new Promise<undefined>((resolve) => setTimeout(resolve, 300)),\n    ]);\n\n    return !!safe;\n  }\n}\n\nexport { SafeAppConnector };\n"],"mappings":"AAAA,OAASA,iBAAiB,KAAQ,gCAAgC,CAElE,MAAO,CAAAC,WAAW,KAA0B,0BAA0B,CACtE,OAASC,eAAe,KAAQ,+BAA+B,CAE/D,KAAM,CAAAC,gBAAgB,QAAS,CAAAH,iBAAkB,CAK/CI,WAAWA,CAACC,IAAW,CAAE,CACvB,KAAK,CAAC,CAAC,CAAC,KALOC,GAAG,aACZC,IAAI,aACJC,QAAQ,QAId,IAAI,CAACF,GAAG,CAAG,GAAI,CAAAL,WAAW,CAACI,IAAI,CAAC,CAClC,CAEA,KAAM,CAAAI,QAAQA,CAAA,CAA6B,CACzC,KAAM,CAAAC,gBAAgB,CAAG,KAAM,KAAI,CAACC,SAAS,CAAC,CAAC,CAC/C,GAAI,CAACD,gBAAgB,CAAE,CACrB,KAAM,IAAI,CAAAE,KAAK,CAAC,wCAAwC,CAAC,CAC3D,CAEA,MAAO,CAAEJ,QAAQ,CAAE,KAAM,KAAI,CAACK,WAAW,CAAC,CAAC,CAAEC,OAAO,CAAE,KAAM,KAAI,CAACC,UAAU,CAAC,CAAC,CAAEC,OAAO,CAAE,KAAM,KAAI,CAACC,UAAU,CAAC,CAAE,CAAC,CACnH,CAEA,KAAa,CAAAC,WAAWA,CAAA,CAAsB,CAC5C,GAAI,CAAC,IAAI,CAACX,IAAI,CAAE,CACd,IAAI,CAACA,IAAI,CAAG,KAAM,KAAI,CAACD,GAAG,CAACC,IAAI,CAACY,OAAO,CAAC,CAAC,CAC3C,CACA,MAAO,KAAI,CAACZ,IAAI,CAClB,CAEA,KAAa,CAAAM,WAAWA,CAAA,CAA6B,CACnD,GAAI,CAAC,IAAI,CAACL,QAAQ,CAAE,CAClB,KAAM,CAAAD,IAAI,CAAG,KAAM,KAAI,CAACW,WAAW,CAAC,CAAC,CACrC,IAAI,CAACV,QAAQ,CAAG,GAAI,CAAAN,eAAe,CAACK,IAAI,CAAE,IAAI,CAACD,GAAG,CAAC,CACrD,CACA,MAAO,KAAI,CAACE,QAAQ,CACtB,CAEA,KAAa,CAAAO,UAAUA,CAAA,CAAoB,CACzC,KAAM,CAAAP,QAAQ,CAAG,KAAM,KAAI,CAACK,WAAW,CAAC,CAAC,CACzC,MAAO,CAAAL,QAAQ,CAACM,OAAO,CACzB,CAEA,KAAa,CAAAG,UAAUA,CAAA,CAAoB,CACzC,KAAM,CAAAV,IAAI,CAAG,KAAM,KAAI,CAACW,WAAW,CAAC,CAAC,CACrC,MAAO,CAAAX,IAAI,CAACa,WAAW,CACzB,CAEOC,UAAUA,CAAA,CAAS,CACxB,OACF,CAEA,KAAa,CAAAV,SAASA,CAAA,CAAqB,KAAAW,OAAA,CACzC;AACA,GAAI,EAAAA,OAAA,CAAAC,MAAM,UAAAD,OAAA,iBAANA,OAAA,CAAQE,MAAM,IAAKD,MAAM,CAAE,CAC7B,MAAO,MAAK,CACd,CAEA,KAAM,CAAAhB,IAAI,CAAG,KAAM,CAAAkB,OAAO,CAACC,IAAI,CAAC,CAC9B,IAAI,CAACR,WAAW,CAAC,CAAC,CAClB,GAAI,CAAAO,OAAO,CAAaE,OAAO,EAAKC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAC9D,CAAC,CAEF,MAAO,CAAC,CAACpB,IAAI,CACf,CACF,CAEA,OAASJ,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}