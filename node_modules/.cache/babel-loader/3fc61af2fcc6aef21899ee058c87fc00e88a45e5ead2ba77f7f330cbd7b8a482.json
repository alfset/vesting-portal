{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nconst typeFields_1 = require('../../typeFields');\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.PARTIAL_SIG) {\n    throw new Error('Decode Error: could not decode partialSig with key 0x' + keyVal.key.toString('hex'));\n  }\n  if (!(keyVal.key.length === 34 || keyVal.key.length === 66) || ![2, 3, 4].includes(keyVal.key[1])) {\n    throw new Error('Decode Error: partialSig has invalid pubkey in key 0x' + keyVal.key.toString('hex'));\n  }\n  const pubkey = keyVal.key.slice(1);\n  return {\n    pubkey,\n    signature: keyVal.value\n  };\n}\nexports.decode = decode;\nfunction encode(pSig) {\n  const head = Buffer.from([typeFields_1.InputTypes.PARTIAL_SIG]);\n  return {\n    key: Buffer.concat([head, pSig.pubkey]),\n    value: pSig.signature\n  };\n}\nexports.encode = encode;\nexports.expected = '{ pubkey: Buffer; signature: Buffer; }';\nfunction check(data) {\n  return Buffer.isBuffer(data.pubkey) && Buffer.isBuffer(data.signature) && [33, 65].includes(data.pubkey.length) && [2, 3, 4].includes(data.pubkey[0]) && isDerSigWithSighash(data.signature);\n}\nexports.check = check;\nfunction isDerSigWithSighash(buf) {\n  if (!Buffer.isBuffer(buf) || buf.length < 9) return false;\n  if (buf[0] !== 0x30) return false;\n  if (buf.length !== buf[1] + 3) return false;\n  if (buf[2] !== 0x02) return false;\n  const rLen = buf[3];\n  if (rLen > 33 || rLen < 1) return false;\n  if (buf[3 + rLen + 1] !== 0x02) return false;\n  const sLen = buf[3 + rLen + 2];\n  if (sLen > 33 || sLen < 1) return false;\n  if (buf.length !== 3 + rLen + 2 + sLen + 2) return false;\n  return true;\n}\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.pubkey.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return array.filter(v => v.pubkey.equals(item.pubkey)).length === 0;\n}\nexports.canAddToArray = canAddToArray;","map":{"version":3,"names":["Object","defineProperty","exports","value","typeFields_1","require","decode","keyVal","key","InputTypes","PARTIAL_SIG","Error","toString","length","includes","pubkey","slice","signature","encode","pSig","head","Buffer","from","concat","expected","check","data","isBuffer","isDerSigWithSighash","buf","rLen","sLen","canAddToArray","array","item","dupeSet","dupeString","has","add","filter","v","equals"],"sources":["/workspace/Planq-Dapps/vesting-portal/node_modules/bip174/src/lib/converter/input/partialSig.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\nconst typeFields_1 = require('../../typeFields');\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.PARTIAL_SIG) {\n    throw new Error(\n      'Decode Error: could not decode partialSig with key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if (\n    !(keyVal.key.length === 34 || keyVal.key.length === 66) ||\n    ![2, 3, 4].includes(keyVal.key[1])\n  ) {\n    throw new Error(\n      'Decode Error: partialSig has invalid pubkey in key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  const pubkey = keyVal.key.slice(1);\n  return {\n    pubkey,\n    signature: keyVal.value,\n  };\n}\nexports.decode = decode;\nfunction encode(pSig) {\n  const head = Buffer.from([typeFields_1.InputTypes.PARTIAL_SIG]);\n  return {\n    key: Buffer.concat([head, pSig.pubkey]),\n    value: pSig.signature,\n  };\n}\nexports.encode = encode;\nexports.expected = '{ pubkey: Buffer; signature: Buffer; }';\nfunction check(data) {\n  return (\n    Buffer.isBuffer(data.pubkey) &&\n    Buffer.isBuffer(data.signature) &&\n    [33, 65].includes(data.pubkey.length) &&\n    [2, 3, 4].includes(data.pubkey[0]) &&\n    isDerSigWithSighash(data.signature)\n  );\n}\nexports.check = check;\nfunction isDerSigWithSighash(buf) {\n  if (!Buffer.isBuffer(buf) || buf.length < 9) return false;\n  if (buf[0] !== 0x30) return false;\n  if (buf.length !== buf[1] + 3) return false;\n  if (buf[2] !== 0x02) return false;\n  const rLen = buf[3];\n  if (rLen > 33 || rLen < 1) return false;\n  if (buf[3 + rLen + 1] !== 0x02) return false;\n  const sLen = buf[3 + rLen + 2];\n  if (sLen > 33 || sLen < 1) return false;\n  if (buf.length !== 3 + rLen + 2 + sLen + 2) return false;\n  return true;\n}\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.pubkey.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return array.filter(v => v.pubkey.equals(item.pubkey)).length === 0;\n}\nexports.canAddToArray = canAddToArray;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}